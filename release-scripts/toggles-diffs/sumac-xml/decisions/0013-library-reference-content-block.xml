<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.21.2 -->
<document source="/Users/sarinacanelake/static-clones/edx-platform/docs/decisions/0013-library-reference-content-block.rst" translation_progress="{'total': 0, 'translated': 0}" xmlns:c="https://www.sphinx-doc.org/" xmlns:changeset="https://www.sphinx-doc.org/" xmlns:citation="https://www.sphinx-doc.org/" xmlns:cpp="https://www.sphinx-doc.org/" xmlns:http="https://www.sphinx-doc.org/" xmlns:index="https://www.sphinx-doc.org/" xmlns:js="https://www.sphinx-doc.org/" xmlns:math="https://www.sphinx-doc.org/" xmlns:py="https://www.sphinx-doc.org/" xmlns:rst="https://www.sphinx-doc.org/" xmlns:std="https://www.sphinx-doc.org/">
    <section ids="referencing-content-blocks-in-library-v2" names="referencing\ content\ blocks\ in\ library\ v2">
        <title>Referencing Content Blocks in Library V2</title>
        <section ids="status" names="status">
            <title>Status</title>
            <paragraph><strong>Deferred</strong> as of September 2023.</paragraph>
            <paragraph>The goals described in the ADR are still relevant to future development,
                but for the intial launch of Blockstore-backed content libraries,
                the existing <literal>library_content</literal> block will be used instead,
                and it will continue to copy blocks from Blockstore into Modulestore as necessary.</paragraph>
        </section>
        <section ids="context" names="context">
            <title>Context</title>
            <paragraph>Currently, courses are being stored in Modulestore (MongoDB) and content libraries
                are stored in both Modulestore (libraries v1) and the Blockstore (libraries v2).
                Until such a time as everything is moved to blockstore, the platform needs a content
                reuse mechanism that allows authors to incorporate content (XBlocks) from blockstore-based
                content libraries (libraries v2) into courses, and that mechanism should be reference-based
                instead of needing to copy content from Blockstore into Modulestore.</paragraph>
            <paragraph>There is work going on to build out the functionality of libraries v2 and migrate all
                usage of content libraries to Blockstore/v2. The benefits of using the blockstore-backed
                v2 content libraries are:</paragraph>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>Blockstore has been designed to support use cases like content libraries and is
                        easier for developers to work with compared to Modulestore, which is not really
                        designed for content libraries.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Blockstore-backed v2 content libraries support any XBlock type, while Modulestore
                        (libraries v1) only supports a few types</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Blockstore-backed v2 content libraries can store large asset files (like images,
                        videos, and PDFs) required by each XBlock, and each file is only stored once no
                        matter how many times it is used.</paragraph>
                </list_item>
            </enumerated_list>
            <section ids="terminology-used" names="terminology\ used">
                <title>Terminology Used</title>
                <enumerated_list enumtype="arabic" prefix="" suffix=".">
                    <list_item>
                        <paragraph>Blocks: Each reusable piece of content in a library. Example: problems, videos,
                            HTML. Also known as Xblocks.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>Library: Collection of blocks that can be used in one or more courses</paragraph>
                    </list_item>
                </enumerated_list>
            </section>
        </section>
        <section ids="decisions" names="decisions">
            <title>Decisions</title>
            <paragraph>As of now, blockstore-backed content libraries (libraries v2) store XBlock data in
                blockstore and when the library is used in a course, the blocks are copied from Blockstore
                to Modulestore with the help of LibrarySourcedBlock.</paragraph>
            <paragraph>The copying of blocks from Blockstore to Modulestore occupies a lot of space and Modulestore
                has a lot of complexity which causes performance issues. The complete elimination of
                Modulestore doesn’t seem to be a pragmatic solution since it is required for backward
                compatibility of courses, and significant development is required before blockstore-based
                courses could achieve feature parity. So the pragmatic solution for content reuse today
                is to allow reusing blockstore content in Modulestore courses more efficiently.</paragraph>
            <paragraph>Hence, instead of storing blocks, the Modulestore will now store a reference to blocks
                from blockstore-backed v2 content libraries. The LMS will use unit_compositor which
                helps to replace each reference with its corresponding library block definitions and
                apply the required course-author-specified customizations before displaying the content
                to learners.</paragraph>
            <paragraph>Studio will provide authors with two separate workflows, once for selecting one or
                more specific blocks and adding those specific blocks to the course, and another workflow
                for selecting a randomized set of blocks, so that each student will see a random block
                out of the set selected by the author.</paragraph>
            <section ids="current-architecture-implementation" names="current\ architecture/implementation">
                <title>Current Architecture/Implementation</title>
                <paragraph>Currently, courses are stored in Modulestore and libraries can either be stored in
                    Modulestore or Blockstore. The [library_sourced_block](<reference refuri="https://github.com/openedx/edx-platform/blob/master/xmodule/library_sourced_block.py">https://github.com/openedx/edx-platform/blob/master/xmodule/library_sourced_block.py</reference>)
                    is used to make a copy of blockstore-based v2 content library block and store it in
                    Modulestore itself as the child.</paragraph>
            </section>
            <section ids="proposed-implementation" names="proposed\ implementation">
                <title>Proposed Implementation</title>
                <paragraph>The library referencing flow would be implemented within the Studio and/or LMS. The
                    library content would be stored and rendered outside the Modulestore.</paragraph>
                <paragraph>This is achieved by a unit_compositor subsystem. Like learning_sequences, the subsystem
                    would be populated by CMS upon course publish. It would store a read-optimized form of:</paragraph>
                <bullet_list bullet="*">
                    <list_item>
                        <paragraph>Metadata and child-block lists for all course Units, and</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>Definitions of library blocks.</paragraph>
                    </list_item>
                </bullet_list>
                <paragraph>The LmsXBlockRuntime (called “CombinedSystem” until BD-13 is done) will be updated to use
                    the unit_compositor as its backing store for units. When a unit is requested for a
                    particular user, [the unit_compositor would](<reference refuri="https://openedx.atlassian.net/wiki/spaces/COMM/pages/3173220481/BD-14+Library+use+cases+implementation+discovery#Example%3A">https://openedx.atlassian.net/wiki/spaces/COMM/pages/3173220481/BD-14+Library+use+cases+implementation+discovery#Example%3A</reference>):</paragraph>
                <enumerated_list enumtype="arabic" prefix="" suffix=".">
                    <list_item>
                        <paragraph>Load the unit’s child blocks from Modulestore.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>Replace each library reference block with its corresponding library block definitions,
                            each overridden with any course-author-specified customizations, and each given a
                            usage key that composes the library reference block’s usage information with the
                            library block’s definition key.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>Return the list of blocks wrapped under a VerticalBlock, with the same usage key
                            as the original unit, for the LmsXBlockRuntime to render.</paragraph>
                    </list_item>
                </enumerated_list>
            </section>
        </section>
        <section ids="goals" names="goals">
            <title>Goals</title>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>Move towards a unit composition system. This would provide long-term stability.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Referenced content will be presented as separate blocks. This will help us take
                        advantage of the atomicity of LMS that is currently being used in courseware
                        (problem grade report, gradebook etc.)</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Extendable to support structural libraries i.e the libraries with units, sequences,
                        and chapters just like how courses are structured right now.</paragraph>
                </list_item>
            </enumerated_list>
        </section>
    </section>
</document>
