<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.21.2 -->
<document source="/Users/sarinacanelake/static-clones/edx-platform/docs/decisions/0006-role-of-xblock.rst" translation_progress="{'total': 0, 'translated': 0}" xmlns:c="https://www.sphinx-doc.org/" xmlns:changeset="https://www.sphinx-doc.org/" xmlns:citation="https://www.sphinx-doc.org/" xmlns:cpp="https://www.sphinx-doc.org/" xmlns:http="https://www.sphinx-doc.org/" xmlns:index="https://www.sphinx-doc.org/" xmlns:js="https://www.sphinx-doc.org/" xmlns:math="https://www.sphinx-doc.org/" xmlns:py="https://www.sphinx-doc.org/" xmlns:rst="https://www.sphinx-doc.org/" xmlns:std="https://www.sphinx-doc.org/">
    <section ids="status" names="status">
        <title>Status</title>
        <paragraph>Proposed</paragraph>
    </section>
    <section ids="context" names="context">
        <title>Context</title>
        <paragraph>XBlock was first envisioned as a nearly all-encompassing, dynamic system. How
            many points is a problem worth? Call its <literal>max_score</literal> method. When is it due?
            Check for the <literal>due</literal> attribute. What other XBlock content does it contain? Ask
            the XBlock for its children. The course content was an object graph of XBlocks
            that were free to implement this sort of functionality in different and
            potentially very powerful ways, allowing for rapid experimentation in grading,
            navigation, etc. This was especially important for edx-platform, which started
            life as a rapidly developed prototype for courseware.</paragraph>
        <paragraph>Unfortunately, such an open ended system made it extremely difficult to make
            guarantees about performance and stability. For instance, many assessment XBlock
            types will return a <literal>1</literal> for its <literal>max_score</literal> method, but <literal>ProblemBlock</literal>
            will introspect its XML to determine how many response fields it has, and use
            that figure. In cases where these problems had to run sandboxed code, getting
            the maximum possible score might involve forking an entire new process and
            making IPC calls to it. If an XBlock wanted to determine its maximum score by
            making a blocking HTTP request to a third-party service, there is nothing
            stopping it from doing so.</paragraph>
        <paragraph>This made operations that traversed many XBlocks (such as navigation, grading,
            or sequence rendering) especially unpredictable, as the cost of getting the most
            basic information could vary by literally six orders of magnitude. Any one
            misbehaving XBlock could sabotage the entire request.</paragraph>
        <paragraph>There were also downstream complications with allowing XBlocks so much freedom.
            Systems such as analytics could not make basic assumptions about course
            structure and problem metadata. If XBlocks wanted to render different child
            XBlocks to different users, or make a problem worth more to users named “jarvis”
            on Wednesday afternoons, it was free to do so. But the analytics system couldn’t
            easily introspect all this internal XBlock logic, meaning that it had to either
            make assumptions that could be incorrect, or dynamically query XBlocks in a way
            that was unpredictably expensive.</paragraph>
        <paragraph>To address these issues, we were forced to sharply constrain what XBlocks were
            permitted to do in practice. This stabilized the site and brought performance to
            a tolerable (though not great) level, but at a significant cost. Numerous low
            level optimizations and access patterns complicated the code, while at the same
            time compromising some of the expressive power of XBlocks. Many of the API calls
            that <emphasis>look</emphasis> dynamic were actually constrainted with unstated assumptions–maximum
            scores are assumed to be consistent across all user, courses are assumed to have
            a Course → Section → Subsection structure, etc.</paragraph>
        <paragraph>Reaching beyond these constraints is still possible, but the results are
            unpredictable. The LMS will still render unusual navigational structures if you
            import it directly via OLX, but mobile clients and analytics will likely break.
            You can define different max scores for different students on the same problem,
            but you will likely see bugs in various places where those scores are cached and
            displayed.</paragraph>
        <paragraph>Largely because of these issues, the XBlock runtime gradually shifted away from
            the all-encompassing role it once played in courseware:</paragraph>
        <bullet_list bullet="*">
            <list_item>
                <paragraph>Grading and Scheduling became distinct subsystems with their own data models
                    and APIs. Instead of these systems synchronously pulling data from XBlock at
                    query time, we push XBlock data into these systems and query them using their
                    own APIs. This has vastly increased the operational stability of the platform.</paragraph>
            </list_item>
            <list_item>
                <paragraph>LTI support has been extracted from <literal>LtiConsumerXBlock</literal>, so that LTI
                    integration can happen outside the XBlock runtime.</paragraph>
            </list_item>
            <list_item>
                <paragraph>There is active planning to add limited QTI support to Open edX.</paragraph>
            </list_item>
            <list_item>
                <paragraph>The <literal>learning_sequence</literal> application is being developed to take over Section
                    and Sequence level navigation, decoupling those concepts from the XBlock
                    runtime in the LMS.</paragraph>
            </list_item>
            <list_item>
                <paragraph>There is a strong interest in creating more adaptive and composable courseware
                    experiences which are difficult to do within the constraints of the XBlock
                    runtime.</paragraph>
            </list_item>
            <list_item>
                <paragraph>There have been early conversations around what a successor to XBlock might
                    look like, though no development work has begun.</paragraph>
            </list_item>
        </bullet_list>
        <paragraph>At the same time, it’s important to note that there are hundreds of XBlocks in
            existence and a vast quantity of valuable content that has been written for
            those XBlocks. Preserving the viability of this content is critical to the
            success of Open edX.</paragraph>
    </section>
    <section ids="decision" names="decision">
        <title>Decision</title>
        <paragraph>XBlocks have provided us a fantastic source of innovative content, at the cost
            of many operational issues. We’ll proceed in a way that allows us to preserve
            the most valuable parts of the XBlock framework, while developing a more
            performant, XBlock-agnostic layer of extensible LMS APIs.</paragraph>
        <paragraph>In concrete terms:</paragraph>
        <bullet_list bullet="*">
            <list_item>
                <paragraph>XBlocks will continue to be supported at the Unit and individual module level
                    (e.g. ProblemBlock, VideoBlock). XBlocks will execute in a container that only
                    has their Unit (VerticalBlock). They will be allowed to query sibling blocks,
                    but will no longer be allowed to freely query their ancestors to get at
                    content in other units, sequences, or the root Course block.</paragraph>
            </list_item>
            <list_item>
                <paragraph>Responsibility for higher level navigation across collections of content (i.e.
                    Sequences, Sections, and Courses) will move to dedicated applications that
                    will have their own, XBlock-agnostic data models and APIs.</paragraph>
            </list_item>
            <list_item>
                <paragraph>A new application will be created to make an XBlock-agnostic model of Units in
                    the LMS, similar to the work that is currently being done around Sequences in
                    <literal>learning_sequences</literal>.</paragraph>
            </list_item>
            <list_item>
                <paragraph>OLX will continue to be supported, including the OLX for navigational
                    structures. They will be mapped to new LMS models and APIs, instead of the
                    XBlock runtime.</paragraph>
            </list_item>
            <list_item>
                <paragraph>XBlock will eventually become a peer runtime to other systems for pluggable
                    course content.</paragraph>
            </list_item>
            <list_item>
                <paragraph>Navigation will have its own set of dedicated, pluggable APIs that are
                    separate from the rendering of individual Units.</paragraph>
            </list_item>
        </bullet_list>
    </section>
    <section ids="goals" names="goals">
        <title>Goals</title>
        <enumerated_list enumtype="arabic" prefix="" suffix=".">
            <list_item>
                <paragraph>Enable rapid innovation in courseware content and navigation.</paragraph>
            </list_item>
            <list_item>
                <paragraph>Preserve backwards compatibility with existing XBlock content.</paragraph>
            </list_item>
            <list_item>
                <paragraph>Improve the reliability, security, and performance of the platform.</paragraph>
            </list_item>
        </enumerated_list>
    </section>
    <section ids="consequences" names="consequences">
        <title>Consequences</title>
        <paragraph>A DEPR will be created for removing the ability for XBlocks to reach outside
            their unit in various ways, such as calling <literal>get_parent</literal> above the Unit level
            or <literal>get_course</literal> to get the root Course XBlock. This would likely happen in the
            Lilac timeframe. XBlocks that are part of the default install of Open edX will
            be updated as necessary.</paragraph>
    </section>
    <section ids="background" names="background">
        <title>Background</title>
        <paragraph>The following give a much more detailed account of the various challenges we’ve
            faced with the XBlock framework over the years:</paragraph>
        <bullet_list bullet="*">
            <list_item>
                <paragraph><reference name="XBlock Lessons Learned" refuri="https://docs.google.com/document/d/1Flj2MS5Neyw6ilSMPdjHqP_4ATX3Qs_pcQdLJIpeSLA/edit?usp=sharing">XBlock Lessons Learned</reference><target ids="xblock-lessons-learned" names="xblock\ lessons\ learned" refuri="https://docs.google.com/document/d/1Flj2MS5Neyw6ilSMPdjHqP_4ATX3Qs_pcQdLJIpeSLA/edit?usp=sharing"></target></paragraph>
            </list_item>
            <list_item>
                <paragraph><reference name="XBlock Lessons: Plugin Performance and Grading" refuri="https://engineering.edx.org/xblock-lessons-plugin-performance-and-grading-2f85a1d6fb2a">XBlock Lessons: Plugin Performance and Grading</reference><target ids="xblock-lessons-plugin-performance-and-grading" names="xblock\ lessons:\ plugin\ performance\ and\ grading" refuri="https://engineering.edx.org/xblock-lessons-plugin-performance-and-grading-2f85a1d6fb2a"></target></paragraph>
            </list_item>
            <list_item>
                <paragraph><reference name="XBlock Field Data Complexity" refuri="https://medium.com/@dormsbee/xblock-lessons-field-data-complexity-2ef32d961b97">XBlock Field Data Complexity</reference><target ids="xblock-field-data-complexity" names="xblock\ field\ data\ complexity" refuri="https://medium.com/@dormsbee/xblock-lessons-field-data-complexity-2ef32d961b97"></target></paragraph>
            </list_item>
        </bullet_list>
    </section>
</document>
