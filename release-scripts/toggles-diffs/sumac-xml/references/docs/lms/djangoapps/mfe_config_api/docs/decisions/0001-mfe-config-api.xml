<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.21.2 -->
<document source="/Users/sarinacanelake/static-clones/edx-platform/docs/references/docs/lms/djangoapps/mfe_config_api/docs/decisions/0001-mfe-config-api.rst" translation_progress="{'total': 0, 'translated': 0}" xmlns:c="https://www.sphinx-doc.org/" xmlns:changeset="https://www.sphinx-doc.org/" xmlns:citation="https://www.sphinx-doc.org/" xmlns:cpp="https://www.sphinx-doc.org/" xmlns:http="https://www.sphinx-doc.org/" xmlns:index="https://www.sphinx-doc.org/" xmlns:js="https://www.sphinx-doc.org/" xmlns:math="https://www.sphinx-doc.org/" xmlns:py="https://www.sphinx-doc.org/" xmlns:rst="https://www.sphinx-doc.org/" xmlns:std="https://www.sphinx-doc.org/">
    <section ids="mfe-config-api" names="0001\ mfe\ config\ api">
        <title>0001 MFE CONFIG API</title>
        <section ids="status" names="status">
            <title>Status</title>
            <paragraph>Accepted</paragraph>
        </section>
        <section ids="context" names="context">
            <title>Context</title>
            <paragraph>Currently, MFE settings are set via command line environment variables or an .env file that is read during the build process, causing the operators to rebuild mfes each time when any variables are changed. The creation of the <literal>mfe_config_api</literal> allows configuration at runtime and avoids rebuilds.
                <reference name="MFE Configuration during Runtime" refuri="https://docs.google.com/document/d/1-FHIQmyeQZu3311x8eYUNMru4JX7Yb3UlqjmJxvM8do/edit?usp=sharing">MFE Configuration during Runtime</reference>.</paragraph>
        </section>
        <section ids="decision" names="decision">
            <title>Decision</title>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>A lightweight API will be created that returns the mfe configuration variables from the site configuration or django settings. <reference name="PR Discussion about django settings" refuri="https://github.com/openedx/edx-platform/pull/30473#discussion_r916263245">PR Discussion about django settings</reference></paragraph>
                </list_item>
                <list_item>
                    <paragraph>The API will be enabled or disabled using the setting <literal>ENABLE_MFE_CONFIG_API</literal>.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>The API will take the mfe configuration in the <literal>MFE_CONFIG</literal> keyset in the site configuration (admin &gt; site configuration &gt; your domain) or in django settings.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>This API allows to consult the configurations by specific MFE. Making a request like <literal>/api/mfe_config/v1?mfe=mymfe</literal> will return the configuration defined in <literal>MFE_CONFIG_OVERRIDES["mymfe"]</literal> merged with the <literal>MFE_CONFIG</literal> configuration.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>The API will have a mechanism to cache the response with <literal>MFE_CONFIG_API_CACHE_TIMEOUT</literal> variable.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>The API will live in lms/djangoapps because this is not something Studio needs to serve and it is a lightweight API. <reference name="PR Discussion" refuri="https://github.com/openedx/edx-platform/pull/30473#issuecomment-1146176151">PR Discussion</reference></paragraph>
                </list_item>
                <list_item>
                    <paragraph>The API will not require authentication or authorization.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>The API request and response will be like:</paragraph>
                </list_item>
            </bullet_list>
            <paragraph>Request:</paragraph>
            <literal_block force="False" language="default" linenos="False" xml:space="preserve">GET http://lms.base.com/api/mfe_config/v1?mfe=learning</literal_block>
            <paragraph>Response:</paragraph>
            <literal_block force="False" language="default" linenos="False" xml:space="preserve">{
            "BASE_URL": "https://name_of_mfe.example.com",
            "LANGUAGE_PREFERENCE_COOKIE_NAME": "example-language-preference",
            "CREDENTIALS_BASE_URL": "https://credentials.example.com",
            "DISCOVERY_API_BASE_URL": "https://discovery.example.com",
            "LMS_BASE_URL": "https://courses.example.com",
            "LOGIN_URL": "https://courses.example.com/login",
            "LOGOUT_URL": "https://courses.example.com/logout",
            "STUDIO_BASE_URL": "https://studio.example.com",
            "LOGO_URL": "https://courses.example.com/logo.png"

}</literal_block>
        </section>
        <section ids="consequences" names="consequences">
            <title>Consequences</title>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>We have to change all the mfes so that they take the information from the API. <reference name="Issue MFE runtime configuration in frontend-wg" refuri="https://github.com/openedx/frontend-wg/issues/103">Issue MFE runtime configuration in frontend-wg</reference></paragraph>
                </list_item>
                <list_item>
                    <paragraph>Initialize the MFE could have a delay due to the HTTP method.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><reference name="Site configuration is going to be deprecated" refuri="https://github.com/openedx/platform-roadmap/issues/21">Site configuration is going to be deprecated</reference> so later we have to clean the code that uses site configuration.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>The operator is responsible for configuring the settings in site configuration or django settings.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>We can have duplicate keys in site configuration (example: we can have a logo definition for each mfe).</paragraph>
                </list_item>
                <list_item>
                    <paragraph>If the request is made from a domain that does not have a site configuration, it returns django settings.</paragraph>
                </list_item>
            </bullet_list>
        </section>
        <section ids="rejected-alternatives" names="rejected\ alternatives">
            <title>Rejected Alternatives</title>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>It was not made as a plugin or IDA because it is a lightweight implementation <reference name="PR Discussion" refuri="https://github.com/openedx/edx-platform/pull/30473#issuecomment-1146176151">PR Discussion</reference></paragraph>
                </list_item>
            </bullet_list>
        </section>
        <section ids="references" names="references">
            <title>References</title>
            <target ids="mfe-configuration-during-runtime" names="mfe\ configuration\ during\ runtime" refuri="https://docs.google.com/document/d/1-FHIQmyeQZu3311x8eYUNMru4JX7Yb3UlqjmJxvM8do/edit?usp=sharing"></target>
            <target ids="pr-discussion" names="pr\ discussion" refuri="https://github.com/openedx/edx-platform/pull/30473#issuecomment-1146176151"></target>
            <target ids="site-configuration-is-going-to-be-deprecated" names="site\ configuration\ is\ going\ to\ be\ deprecated" refuri="https://github.com/openedx/platform-roadmap/issues/21"></target>
            <target ids="issue-mfe-runtime-configuration-in-frontend-wg" names="issue\ mfe\ runtime\ configuration\ in\ frontend-wg" refuri="https://github.com/openedx/frontend-wg/issues/103"></target>
            <target ids="pr-discussion-about-django-settings" names="pr\ discussion\ about\ django\ settings" refuri="https://github.com/openedx/edx-platform/pull/30473#discussion_r916263245"></target>
        </section>
    </section>
</document>
