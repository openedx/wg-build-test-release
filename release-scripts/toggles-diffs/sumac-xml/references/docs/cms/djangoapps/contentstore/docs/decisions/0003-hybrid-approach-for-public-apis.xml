<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.21.2 -->
<document source="/Users/sarinacanelake/static-clones/edx-platform/docs/references/docs/cms/djangoapps/contentstore/docs/decisions/0003-hybrid-approach-for-public-apis.rst" translation_progress="{'total': 0, 'translated': 0}" xmlns:c="https://www.sphinx-doc.org/" xmlns:changeset="https://www.sphinx-doc.org/" xmlns:citation="https://www.sphinx-doc.org/" xmlns:cpp="https://www.sphinx-doc.org/" xmlns:http="https://www.sphinx-doc.org/" xmlns:index="https://www.sphinx-doc.org/" xmlns:js="https://www.sphinx-doc.org/" xmlns:math="https://www.sphinx-doc.org/" xmlns:py="https://www.sphinx-doc.org/" xmlns:rst="https://www.sphinx-doc.org/" xmlns:std="https://www.sphinx-doc.org/">
    <section ids="hybrid-approach-for-public-course-authoring-apis" names="0003:\ hybrid\ approach\ for\ public\ course\ authoring\ apis">
        <title>0003: Hybrid approach for public course authoring APIs</title>
        <section ids="status" names="status">
            <title>Status</title>
            <paragraph>Rejected</paragraph>
        </section>
        <section ids="reason-for-rejection" names="reason\ for\ rejection">
            <title>Reason for rejection</title>
            <paragraph>The objectives for public authoring APIs changed from the time this decision was made:
                We are now limiting our offering to a set of experimental APIs with which to flesh our what a supported set of APIs might become. As such, the authoring APIs we are now implementing
                are just a public set of wrappers around existing functionality, and are not fit for production course authoring. The responsibility for avoiding conflicts and resolving them, if they occur, is on the user.</paragraph>
        </section>
        <section ids="context" names="context">
            <title>Context</title>
            <paragraph>We are planning to offer public APIs via oauth that allow course authors to create
                and update course content via an external application. The plan for this is outlined in this
                <reference name="Spec Demo" refuri="https://openedx.atlassian.net/wiki/spaces/COMM/pages/3696066564/Spec+Memo+API-Based+Management+of+edX+Course+Blocks+Outlines+and+Settings+MVP.">Spec Demo</reference>.</paragraph>
            <target ids="spec-demo" names="spec\ demo" refuri="https://openedx.atlassian.net/wiki/spaces/COMM/pages/3696066564/Spec+Memo+API-Based+Management+of+edX+Course+Blocks+Outlines+and+Settings+MVP."></target>
            <paragraph>Rather than restricting a course to only ever be editable either via API or manually,
                we will offer a hybrid solution where both are possible.</paragraph>
            <paragraph>A hybrid solution faces two challenges:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>“out-of-date write conflicts”: how do we handle a situation where an API user attempts to update
                        a course using a stale course snapshot as a starting point?
                        This creates a danger of overwriting another person’s changes.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>“dirty writes”: how do we handle a situation where there are multiple concurrent, asynchronous import or update
                        operations that may be in conflict with each other?</paragraph>
                </list_item>
            </bullet_list>
            <paragraph>Some considerations that come into play when picking an approach are:</paragraph>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>Having the system reliably play traffic cop isn’t simple, principally because of our reliance on slow-running async tasks.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Even if we ignore the problem of playing traffic cop, embracing hybrid editing means clients need some way to know
                        whether other users have made changes.</paragraph>
                </list_item>
            </enumerated_list>
            <paragraph>We analyzed a range of the most viable options to handle these challenges.
                We ruled out any we found to be much too risky or much too hard to implement due to a high amount of complexity.
                That left us with three alternatives, of which we rejected the following two:</paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>adding a toggle that lets users switch the course between enforcing only manual editing
                        and only API editing. This toggle needs to allow for running import operations to finish before switching, thus making it complex.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>using a form of optimistic concurrency control where we expect different users and explicitly version each change, then forbid
                        any API operation unless the API operator provides a version identifier that is not out of date.</paragraph>
                </list_item>
            </bullet_list>
            <paragraph>We rejected these challenges on the basis that they were complex to implement and make us play “Traffic cop”.</paragraph>
            <paragraph>However, future iterations on the API may require us to be more strict and employ further safeguards, and it remains a possibility to circle
                back and add one of these options on top of what we do now initially.</paragraph>
            <paragraph>Another complication is that our planned solution is limited in terms of rollback capabilities: xblocks are internally versioned
                and we can use this internal versioning to offer rollback tools, and this extends to rolling back changes to their tree structure
                (for example adding subtrees, reordering child xblocks, etc). However, other files that are imported, like static assets and some course-level
                configuration, do not have this versioning capabilities. According to our planned architecture around these APIs, we will not support versioning
                and rollback on our side. Instead, we expect users to handle this problem themselves by having backups and version control for these files independently.</paragraph>
            <paragraph>We also do not offer any draft capabilities for the API; changes will be immediately published.</paragraph>
        </section>
        <section ids="decision" names="decision">
            <title>Decision</title>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph>We consider the user responsible for avoiding, resolving, or fixing conflicts.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Courses that are operated in this hybrid fashion - that is, they are being edited not just via studio, but also via API -
                        are intended to be edited by one user at a time. In the API documentation, we will ask users to follow this principle.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>While we don’t plan to enforce this prohibition of concurrent users today, leaving it as a self-policing responsibility users bear,
                        we leave open the option of doing so in the future..</paragraph>
                </list_item>
                <list_item>
                    <paragraph>We provide logs about past changes to the user to alert them of other users’ changes.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>We provide sufficient rollback tools to fix any problems with xblocks / xblock structure the users may have caused.
                        Provided that modulestore versioning makes older versions of an XBlock available, we will provide a programmatic way to replace the current version
                        of an XBlock with an older version, referenced by version ID.
                        Our current goal is to offer this packaged as a “undo task” operation.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>We do not provide any versioning, rolling back, or logging for anything that is not an xblock (static assets,
                        course-level policies and settings, etc). We recommend that the users employ version control for this on their side.</paragraph>
                </list_item>
            </bullet_list>
        </section>
        <section ids="consequences" names="consequences">
            <title>Consequences</title>
            <paragraph>The decision not to enforce a limit of one client at a time means that users may run into conflicts or problems if they
                do not follow our instruction to work one at a time and coordinate.
                Because no rollback capabilities are offered by the API for course assets, the burden of maintaining assets under external
                source control falls on the user; a user’s failure to do so may lead to irrevocable content loss on course corruption.</paragraph>
            <paragraph>With this decision, we make clear where the responsibility lies for dealing with problems. We do not have to
                build a complex mechanism to avoid or resolve conflicts (“playing traffic cop”);
                and consequently, we do not need to act on any errors that happen when this mechanism isn’t perfect.</paragraph>
            <paragraph>However, there may very well arise the needs to add safeguards in the future. The most straightforward and simple action would be to
                actually enforce this one-concurrent-user policy and not allowing more than one user to edit concurrently.</paragraph>
        </section>
    </section>
</document>
