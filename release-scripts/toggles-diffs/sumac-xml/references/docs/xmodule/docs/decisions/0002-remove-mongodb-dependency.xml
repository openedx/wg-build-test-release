<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.21.2 -->
<document source="/Users/sarinacanelake/static-clones/edx-platform/docs/references/docs/xmodule/docs/decisions/0002-remove-mongodb-dependency.rst" translation_progress="{'total': 0, 'translated': 0}" xmlns:c="https://www.sphinx-doc.org/" xmlns:changeset="https://www.sphinx-doc.org/" xmlns:citation="https://www.sphinx-doc.org/" xmlns:cpp="https://www.sphinx-doc.org/" xmlns:http="https://www.sphinx-doc.org/" xmlns:index="https://www.sphinx-doc.org/" xmlns:js="https://www.sphinx-doc.org/" xmlns:math="https://www.sphinx-doc.org/" xmlns:py="https://www.sphinx-doc.org/" xmlns:rst="https://www.sphinx-doc.org/" xmlns:std="https://www.sphinx-doc.org/">
    <section ids="remove-mongodb-as-a-dependency" names="remove\ mongodb\ as\ a\ dependency">
        <title>Remove MongoDB as a Dependency</title>
        <section ids="context" names="context">
            <title>Context</title>
            <paragraph>The edx-platform repo uses MongoDB for storing content (the ModuleStore and ContentStore interfaces). MongoDB was chosen early on in the Open edX project because:</paragraph>
            <bullet_list bullet="*">
                <list_item>
                    <paragraph><strong>Course content is very freeform</strong>, and XBlock is a pluggable interface. So while the data stored for videos, problems, crystallography simulations, and circuit schematic editors might have some overlap, individual XBlock are permitted to extend that storage any way they like. At the time, this struck us as a more document-database-centric than SQL.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>MongoDB’s GridFS</strong> seemed liked a good solution for the static assets that need to be managed on a per-course basis (e.g. PDFs).</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>MySQL at the time did not support JSON fields.</strong> This would have made certain search operations more cumbersome. (MySQL itself was chosen because PostgreSQL was not available on RDS at the time).</paragraph>
                </list_item>
            </bullet_list>
            <paragraph>Since that time, several things have changed:</paragraph>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>We’ve been trying to reduce the complexity of the stack needed to run Open edX.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>We’ve switched over from the original <literal>DraftModuleStore</literal> to <literal>DraftVersioningModuleStore</literal>. The latter drops most query patterns and mostly uses MongoDB as a simple key value store.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>We’ve adopted django-storages for pluggable file/blob storage.</paragraph>
                </list_item>
            </enumerated_list>
        </section>
        <section ids="decisions" names="decisions">
            <title>Decisions</title>
            <paragraph>All usage of MongoDB in edx-platform will be removed or replaced in the following ways:</paragraph>
            <bullet_list bullet="*">
                <list_item>
                    <paragraph>Old Mongo (<literal>DraftModuleStore</literal>) will be removed as a storage backend altogether. This is already covered under DEPR-58, and affects only old style courses with course keys in the “Org/Course/Run” format (as opposed to the “course-v1:Org+Course+Run” format).</paragraph>
                </list_item>
                <list_item>
                    <paragraph>ContentStore storage of course static assets will be moved to django-storages, allowing for pluggable backends (e.g. files, S3, GridFS).</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Split Modulestore (<literal>DraftVersioningModuleStore</literal>) will be moved to use the Django ORM for the active version lookup, and django-storages to replace key-value storage of what are structure and definition documents today.</paragraph>
                </list_item>
            </bullet_list>
            <paragraph>Note that this does not include the use of MongoDB for the forums experience. While I still believe that removing MongoDB for that service is desirable, it’s beyond the scope of this particular ADR.</paragraph>
        </section>
    </section>
</document>
