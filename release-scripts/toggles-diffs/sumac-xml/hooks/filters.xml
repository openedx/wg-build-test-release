<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.21.2 -->
<document source="/Users/sarinacanelake/static-clones/edx-platform/docs/hooks/filters.rst" translation_progress="{'total': 0, 'translated': 0}" xmlns:c="https://www.sphinx-doc.org/" xmlns:changeset="https://www.sphinx-doc.org/" xmlns:citation="https://www.sphinx-doc.org/" xmlns:cpp="https://www.sphinx-doc.org/" xmlns:http="https://www.sphinx-doc.org/" xmlns:index="https://www.sphinx-doc.org/" xmlns:js="https://www.sphinx-doc.org/" xmlns:math="https://www.sphinx-doc.org/" xmlns:py="https://www.sphinx-doc.org/" xmlns:rst="https://www.sphinx-doc.org/" xmlns:std="https://www.sphinx-doc.org/">
    <section ids="open-edx-filters" names="open\ edx\ filters">
        <title>Open edX Filters</title>
        <section ids="how-to-use" names="how\ to\ use">
            <title>How to use</title>
            <paragraph>Using openedx-filters in your code is very straight forward. We can consider the
                two possible cases:</paragraph>
            <section ids="configuring-a-filter" names="configuring\ a\ filter">
                <title>Configuring a filter</title>
                <section ids="implement-pipeline-steps" names="implement\ pipeline\ steps">
                    <title>Implement pipeline steps</title>
                    <paragraph>Let’s say you want to consult student’s information with a third party service
                        before generating the students certificate. This is a common use case for filters,
                        where the functions part of the filter’s pipeline will perform the consulting tasks and
                        decide the execution flow for the application. These functions are the pipeline steps,
                        and can be implemented in an installable Python library:</paragraph>
                    <literal_block force="False" highlight_args="{}" language="python" linenos="False" xml:space="preserve"># Step implementation taken from openedx-filters-samples plugin
from openedx_filters import PipelineStep
from openedx_filters.learning.filters import CertificateCreationRequested

class StopCertificateCreation(PipelineStep):

    def run_filter(self, user, course_id, mode, status):
        # Consult third party service and check if continue
        # ...
        # User not in third party service, denied certificate generation
        raise CertificateCreationRequested.PreventCertificateCreation(
            "You can't generate a certificate from this site."
        )</literal_block>
                    <paragraph>There’s two key components to the implementation:</paragraph>
                    <enumerated_list enumtype="arabic" prefix="" suffix=".">
                        <list_item>
                            <paragraph>The filter step must be a subclass of <literal>PipelineStep</literal>.</paragraph>
                        </list_item>
                    </enumerated_list>
                    <paragraph>2. The <literal>run_filter</literal> signature must match the filters definition, eg.,
                        the previous step matches the method’s definition in CertificateCreationRequested.</paragraph>
                </section>
                <section ids="attach-hook-pipeline-to-filter" names="attach/hook\ pipeline\ to\ filter">
                    <title>Attach/hook pipeline to filter</title>
                    <paragraph>After implementing the pipeline steps, we have to tell the certificate creation
                        filter to execute our pipeline.</paragraph>
                    <literal_block force="False" highlight_args="{}" language="python" linenos="False" xml:space="preserve">OPEN_EDX_FILTERS_CONFIG = {
    "org.openedx.learning.certificate.creation.requested.v1": {
        "fail_silently": False,
        "pipeline": [
            "openedx_filters_samples.samples.pipeline.StopCertificateCreation"
        ]
    },
}</literal_block>
                </section>
            </section>
            <section ids="triggering-a-filter" names="triggering\ a\ filter">
                <title>Triggering a filter</title>
                <paragraph>In order to execute a filter in your own plugin/library, you must install the
                    plugin where the steps are implemented and also, <literal>openedx-filters</literal>.</paragraph>
                <literal_block force="False" highlight_args="{}" language="python" linenos="False" xml:space="preserve"># Code taken from lms/djangoapps/certificates/generation_handler.py
from openedx_filters.learning.filters import CertificateCreationRequested

try:
    self.user, self.course_id, self.mode, self.status = CertificateCreationRequested.run_filter(
        user=self.user, course_id=self.course_id, mode=self.mode, status=self.status,
    )
except CertificateCreationRequested.PreventCertificateCreation as exc:
    raise CertificateGenerationNotAllowed(str(exc)) from exc</literal_block>
            </section>
            <section ids="testing-filters-steps" names="testing\ filters'\ steps">
                <title>Testing filters’ steps</title>
                <paragraph>It’s pretty straightforward to test your pipeline steps, you’ll need to include the
                    <literal>openedx-filters</literal> library in your testing dependencies and configure them in your test case.</paragraph>
                <literal_block force="False" highlight_args="{}" language="python" linenos="False" xml:space="preserve">from openedx_filters.learning.filters import CertificateCreationRequested

 @override_settings(
     OPEN_EDX_FILTERS_CONFIG={
         "org.openedx.learning.certificate.creation.requested.v1": {
             "fail_silently": False,
             "pipeline": [
                 "openedx_filters_samples.samples.pipeline.StopCertificateCreation"
             ]
         }
     }
 )
 def test_certificate_creation_requested_filter(self):
     """
     Test filter triggered before the certificate creation process starts.

     Expected results:
       - The pipeline step configured for the filter raises PreventCertificateCreation
       when the conditions are met.
     """
     with self.assertRaises(CertificateCreationRequested.PreventCertificateCreation):
         CertificateCreationRequested.run_filter(
             user=self.user, course_key=self.course_key, mode="audit",
         )

     # run your assertions</literal_block>
                <paragraph>Changes in the <literal>openedx-filters</literal> library that are not compatible with your code
                    should break this kind of test in CI and let you know you need to upgrade your code.
                    The main limitation while testing filters’ steps it’s their arguments, as they are edxapp
                    memory objects, but that can be solved in CI using Python mocks.</paragraph>
            </section>
            <section ids="live-example" names="live\ example">
                <title>Live example</title>
                <paragraph>For filter steps samples you can visit the <reference name="openedx-filters-samples" refuri="https://github.com/eduNEXT/openedx-filters-samples">openedx-filters-samples</reference> plugin, where
                    you can find minimal steps exemplifying the different ways on how to use
                    <literal>openedx-filters</literal>.</paragraph>
                <target ids="openedx-filters-samples" names="openedx-filters-samples" refuri="https://github.com/eduNEXT/openedx-filters-samples"></target>
            </section>
        </section>
        <section ids="index-of-filters" names="index\ of\ filters">
            <title>Index of Filters</title>
            <paragraph>This list contains the filters currently being executed by edx-platform. The provided
                links target both the definition of the filter in the openedx-filters library as
                well as the trigger location in this same repository.</paragraph>
            <table classes="colwidths-given">
                <tgroup cols="3">
                    <colspec colwidth="35"></colspec>
                    <colspec colwidth="50"></colspec>
                    <colspec colwidth="20"></colspec>
                    <tbody>
                        <row>
                            <entry>
                                <paragraph><emphasis>Name</emphasis></paragraph>
                            </entry>
                            <entry>
                                <paragraph><emphasis>Type</emphasis></paragraph>
                            </entry>
                            <entry>
                                <paragraph><emphasis>Date added</emphasis></paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><reference name="StudentRegistrationRequested" refuri="https://github.com/eduNEXT/openedx-filters/blob/main/openedx_filters/learning/filters.py#L9">StudentRegistrationRequested</reference><target ids="studentregistrationrequested" names="studentregistrationrequested" refuri="https://github.com/eduNEXT/openedx-filters/blob/main/openedx_filters/learning/filters.py#L9"></target></paragraph>
                            </entry>
                            <entry>
                                <paragraph>org.openedx.learning.student.registration.requested.v1</paragraph>
                            </entry>
                            <entry>
                                <paragraph><reference name="2022-06-14" refuri="https://github.com/openedx/edx-platform/blob/master/openedx/core/djangoapps/user_authn/views/register.py#L261">2022-06-14</reference><target dupnames="2022-06-14" ids="id1" refuri="https://github.com/openedx/edx-platform/blob/master/openedx/core/djangoapps/user_authn/views/register.py#L261"></target></paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><reference name="StudentLoginRequested" refuri="https://github.com/eduNEXT/openedx-filters/blob/main/openedx_filters/learning/filters.py#L40">StudentLoginRequested</reference><target ids="studentloginrequested" names="studentloginrequested" refuri="https://github.com/eduNEXT/openedx-filters/blob/main/openedx_filters/learning/filters.py#L40"></target></paragraph>
                            </entry>
                            <entry>
                                <paragraph>org.openedx.learning.student.login.requested.v1</paragraph>
                            </entry>
                            <entry>
                                <paragraph><reference name="2022-06-14" refuri="https://github.com/openedx/edx-platform/blob/master/openedx/core/djangoapps/user_authn/views/login.py#L569">2022-06-14</reference><target dupnames="2022-06-14" ids="id2" refuri="https://github.com/openedx/edx-platform/blob/master/openedx/core/djangoapps/user_authn/views/login.py#L569"></target></paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><reference name="CourseEnrollmentStarted" refuri="https://github.com/eduNEXT/openedx-filters/blob/main/openedx_filters/learning/filters.py#L70">CourseEnrollmentStarted</reference><target ids="courseenrollmentstarted" names="courseenrollmentstarted" refuri="https://github.com/eduNEXT/openedx-filters/blob/main/openedx_filters/learning/filters.py#L70"></target></paragraph>
                            </entry>
                            <entry>
                                <paragraph>org.openedx.learning.course.enrollment.started.v1</paragraph>
                            </entry>
                            <entry>
                                <paragraph><reference name="2022-06-14" refuri="https://github.com/openedx/edx-platform/blob/master/common/djangoapps/student/models.py#L1675">2022-06-14</reference><target dupnames="2022-06-14" ids="id3" refuri="https://github.com/openedx/edx-platform/blob/master/common/djangoapps/student/models.py#L1675"></target></paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><reference name="CourseUnenrollmentStarted" refuri="https://github.com/eduNEXT/openedx-filters/blob/main/openedx_filters/learning/filters.py#L98">CourseUnenrollmentStarted</reference><target ids="courseunenrollmentstarted" names="courseunenrollmentstarted" refuri="https://github.com/eduNEXT/openedx-filters/blob/main/openedx_filters/learning/filters.py#L98"></target></paragraph>
                            </entry>
                            <entry>
                                <paragraph>org.openedx.learning.course.unenrollment.started.v1</paragraph>
                            </entry>
                            <entry>
                                <paragraph><reference name="2022-06-14" refuri="https://github.com/eduNEXT/edx-platform/blob/master/common/djangoapps/student/models.py#L1752">2022-06-14</reference><target dupnames="2022-06-14" ids="id4" refuri="https://github.com/eduNEXT/edx-platform/blob/master/common/djangoapps/student/models.py#L1752"></target></paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><reference name="CertificateCreationRequested" refuri="https://github.com/openedx/openedx-filters/blob/main/openedx_filters/learning/filters.py#L142">CertificateCreationRequested</reference><target ids="certificatecreationrequested" names="certificatecreationrequested" refuri="https://github.com/openedx/openedx-filters/blob/main/openedx_filters/learning/filters.py#L142"></target></paragraph>
                            </entry>
                            <entry>
                                <paragraph>org.openedx.learning.certificate.creation.requested.v1</paragraph>
                            </entry>
                            <entry>
                                <paragraph><reference name="2022-06-14" refuri="https://github.com/eduNEXT/edx-platform/blob/master/lms/djangoapps/certificates/generation_handler.py#L119">2022-06-14</reference><target dupnames="2022-06-14" ids="id5" refuri="https://github.com/eduNEXT/edx-platform/blob/master/lms/djangoapps/certificates/generation_handler.py#L119"></target></paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><reference name="CertificateRenderStarted" refuri="https://github.com/openedx/openedx-filters/blob/main/openedx_filters/learning/filters.py#L161">CertificateRenderStarted</reference><target ids="certificaterenderstarted" names="certificaterenderstarted" refuri="https://github.com/openedx/openedx-filters/blob/main/openedx_filters/learning/filters.py#L161"></target></paragraph>
                            </entry>
                            <entry>
                                <paragraph>org.openedx.learning.certificate.render.started.v1</paragraph>
                            </entry>
                            <entry>
                                <paragraph><reference name="2022-06-14" refuri="https://github.com/eduNEXT/edx-platform/blob/master/lms/djangoapps/certificates/views/webview.py#L649">2022-06-14</reference><target dupnames="2022-06-14" ids="id6" refuri="https://github.com/eduNEXT/edx-platform/blob/master/lms/djangoapps/certificates/views/webview.py#L649"></target></paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><reference name="CohortChangeRequested" refuri="https://github.com/openedx/openedx-filters/blob/main/openedx_filters/learning/filters.py#L230">CohortChangeRequested</reference><target ids="cohortchangerequested" names="cohortchangerequested" refuri="https://github.com/openedx/openedx-filters/blob/main/openedx_filters/learning/filters.py#L230"></target></paragraph>
                            </entry>
                            <entry>
                                <paragraph>org.openedx.learning.cohort.change.requested.v1</paragraph>
                            </entry>
                            <entry>
                                <paragraph><reference name="2022-06-14" refuri="https://github.com/eduNEXT/edx-platform/blob/master/openedx/core/djangoapps/course_groups/models.py#L138">2022-06-14</reference><target dupnames="2022-06-14" ids="id7" refuri="https://github.com/eduNEXT/edx-platform/blob/master/openedx/core/djangoapps/course_groups/models.py#L138"></target></paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><reference name="CohortAssignmentRequested" refuri="https://github.com/openedx/openedx-filters/blob/main/openedx_filters/learning/filters.py#L256">CohortAssignmentRequested</reference><target ids="cohortassignmentrequested" names="cohortassignmentrequested" refuri="https://github.com/openedx/openedx-filters/blob/main/openedx_filters/learning/filters.py#L256"></target></paragraph>
                            </entry>
                            <entry>
                                <paragraph>org.openedx.learning.cohort.assignment.requested.v1</paragraph>
                            </entry>
                            <entry>
                                <paragraph><reference name="2022-06-14" refuri="https://github.com/eduNEXT/edx-platform/blob/master/openedx/core/djangoapps/course_groups/models.py#L149">2022-06-14</reference><target dupnames="2022-06-14" ids="id8" refuri="https://github.com/eduNEXT/edx-platform/blob/master/openedx/core/djangoapps/course_groups/models.py#L149"></target></paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><reference name="CourseAboutRenderStarted" refuri="https://github.com/openedx/openedx-filters/blob/main/openedx_filters/learning/filters.py#L281">CourseAboutRenderStarted</reference><target ids="courseaboutrenderstarted" names="courseaboutrenderstarted" refuri="https://github.com/openedx/openedx-filters/blob/main/openedx_filters/learning/filters.py#L281"></target></paragraph>
                            </entry>
                            <entry>
                                <paragraph>org.openedx.learning.course_about.render.started.v1</paragraph>
                            </entry>
                            <entry>
                                <paragraph><reference name="2022-06-14" refuri="https://github.com/eduNEXT/edx-platform/blob/master/lms/djangoapps/courseware/views/views.py#L1015">2022-06-14</reference><target dupnames="2022-06-14" ids="id9" refuri="https://github.com/eduNEXT/edx-platform/blob/master/lms/djangoapps/courseware/views/views.py#L1015"></target></paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><reference name="DashboardRenderStarted" refuri="https://github.com/openedx/openedx-filters/blob/main/openedx_filters/learning/filters.py#L354">DashboardRenderStarted</reference><target ids="dashboardrenderstarted" names="dashboardrenderstarted" refuri="https://github.com/openedx/openedx-filters/blob/main/openedx_filters/learning/filters.py#L354"></target></paragraph>
                            </entry>
                            <entry>
                                <paragraph>org.openedx.learning.dashboard.render.started.v1</paragraph>
                            </entry>
                            <entry>
                                <paragraph><reference name="2022-06-14" refuri="https://github.com/eduNEXT/edx-platform/blob/master/common/djangoapps/student/views/dashboard.py#L878">2022-06-14</reference><target dupnames="2022-06-14" ids="id10" refuri="https://github.com/eduNEXT/edx-platform/blob/master/common/djangoapps/student/views/dashboard.py#L878"></target></paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><reference name="VerticalBlockChildRenderStarted" refuri="https://github.com/openedx/openedx-filters/blob/main/openedx_filters/learning/filters.py#L427">VerticalBlockChildRenderStarted</reference><target ids="verticalblockchildrenderstarted" names="verticalblockchildrenderstarted" refuri="https://github.com/openedx/openedx-filters/blob/main/openedx_filters/learning/filters.py#L427"></target></paragraph>
                            </entry>
                            <entry>
                                <paragraph>org.openedx.learning.veritical_block_child.render.started.v1</paragraph>
                            </entry>
                            <entry>
                                <paragraph><reference name="2022-08-18" refuri="https://github.com/openedx/edx-platform/blob/master/xmodule/vertical_block.py#L170">2022-08-18</reference><target ids="id11" names="2022-08-18" refuri="https://github.com/openedx/edx-platform/blob/master/xmodule/vertical_block.py#L170"></target></paragraph>
                            </entry>
                        </row>
                        <row>
                            <entry>
                                <paragraph><reference name="VerticalBlockRenderCompleted" refuri="https://github.com/openedx/openedx-filters/blob/main/openedx_filters/learning/filters.py#L476">VerticalBlockRenderCompleted</reference><target ids="verticalblockrendercompleted" names="verticalblockrendercompleted" refuri="https://github.com/openedx/openedx-filters/blob/main/openedx_filters/learning/filters.py#L476"></target></paragraph>
                            </entry>
                            <entry>
                                <paragraph>org.openedx.learning.veritical_block.render.completed.v1</paragraph>
                            </entry>
                            <entry>
                                <paragraph><reference name="2022-02-18" refuri="https://github.com/openedx/edx-platform/blob/master/xmodule/vertical_block.py#L121">2022-02-18</reference><target ids="id12" names="2022-02-18" refuri="https://github.com/openedx/edx-platform/blob/master/xmodule/vertical_block.py#L121"></target></paragraph>
                            </entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
        </section>
    </section>
</document>
