<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.21.2 -->
<document source="/Users/sarinacanelake/openedx/edx-platform/docs/decisions/0019-oep-58-atlas-translations-design.rst" translation_progress="{'total': 0, 'translated': 0}" xmlns:c="https://www.sphinx-doc.org/" xmlns:changeset="https://www.sphinx-doc.org/" xmlns:citation="https://www.sphinx-doc.org/" xmlns:cpp="https://www.sphinx-doc.org/" xmlns:http="https://www.sphinx-doc.org/" xmlns:index="https://www.sphinx-doc.org/" xmlns:js="https://www.sphinx-doc.org/" xmlns:math="https://www.sphinx-doc.org/" xmlns:py="https://www.sphinx-doc.org/" xmlns:rst="https://www.sphinx-doc.org/" xmlns:std="https://www.sphinx-doc.org/">
    <section ids="design-for-refactoring-translations-pull-to-use-atlas" names="design\ for\ refactoring\ translations\ pull\ to\ use\ atlas">
        <title>Design for Refactoring Translations <literal>pull</literal> to use Atlas</title>
        <section ids="status" names="status">
            <title>Status</title>
            <paragraph>Accepted</paragraph>
        </section>
        <section ids="context" names="context">
            <title>Context</title>
            <section ids="oep-58-translation-management-overview" names="oep-58\ translation\ management\ overview">
                <title>OEP-58 Translation Management overview</title>
                <paragraph>The <reference name="Translation Management update OEP-58" refuri="https://open-edx-proposals.readthedocs.io/en/latest/architectural-decisions/oep-0058-arch-translations-management.html#specification">Translation Management update OEP-58</reference> proposal has been merged with
                    the following changes to the way translations are managed in the Open edX platform:</paragraph>
                <bullet_list bullet="-">
                    <list_item>
                        <paragraph>Move Translation Files to the <reference name="openedx-translations repo" refuri="https://github.com/openedx/openedx-translations">openedx-translations repo</reference></paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>Add the <reference name="Transifex GitHub App" refuri="https://github.com/apps/transifex-integration">Transifex GitHub App</reference><target ids="transifex-github-app" names="transifex\ github\ app" refuri="https://github.com/apps/transifex-integration"></target>
                            to openedx Organization</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>Connect the <reference name="openedx-translations repo" refuri="https://github.com/openedx/openedx-translations">openedx-translations repo</reference> to the
                            <reference name="openedx-translations Transifex project" refuri="https://app.transifex.com/open-edx/openedx-translations/dashboard/">openedx-translations Transifex project</reference></paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>Copy <reference name="Transifex Translation Memory" refuri="https://help.transifex.com/en/articles/6224636-introduction-to-translation-memory">Transifex Translation Memory</reference> into from the both of the
                            <reference name="edx-platform Transifex project" refuri="https://www.transifex.com/open-edx/edx-platform/">edx-platform Transifex project</reference> and the <reference name="xblocks Transifex project" refuri="https://www.transifex.com/open-edx/xblocks/">xblocks Transifex project</reference> into
                            the new <reference name="openedx-translations Transifex project" refuri="https://app.transifex.com/open-edx/openedx-translations/dashboard/">openedx-translations Transifex project</reference></paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>Utilize <reference name="openedx-atlas" refuri="https://github.com/openedx/openedx-atlas">openedx-atlas</reference> to pull translations for development/deployment.</paragraph>
                    </list_item>
                </bullet_list>
                <paragraph>If you’re new to the <reference name="OEP-58" refuri="https://open-edx-proposals.readthedocs.io/en/latest/architectural-decisions/oep-0058-arch-translations-management.html#specification">OEP-58</reference> proposal, please
                    review the <reference name="OEP-58 Specifications" refuri="https://open-edx-proposals.readthedocs.io/en/latest/architectural-decisions/oep-0058-arch-translations-management.html#specification">OEP-58 Specifications</reference> in addition to the
                    Key Metrics and Expected Results section in the
                    <reference name="Approach Memo and Technical Discovery - Translations Infrastructure Implementation" refuri="https://docs.google.com/document/d/11dFBCnbdHiCEdZp3pZeHdeH8m7Glla-XbIin7cnIOzU/edit">Approach Memo and Technical Discovery - Translations Infrastructure Implementation</reference>
                    document before continuing.</paragraph>
            </section>
            <section ids="pre-oep-58-architecture-implementation-for-xblocks-and-plugins" names="pre-oep-58\ architecture/implementation\ for\ xblocks\ and\ plugins">
                <title>Pre-OEP-58 Architecture/Implementation for XBlocks and Plugins</title>
                <paragraph>Before <reference name="OEP-58" refuri="https://open-edx-proposals.readthedocs.io/en/latest/architectural-decisions/oep-0058-arch-translations-management.html#specification">OEP-58</reference>, Open edX XBlocks and Open edX plugins had the following:</paragraph>
                <bullet_list bullet="-">
                    <list_item>
                        <paragraph>Translations live in the GitHub repository.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>Translations are packaged with the rest of the code when published to pypi</paragraph>
                    </list_item>
                </bullet_list>
                <paragraph>Pros:</paragraph>
                <bullet_list bullet="-">
                    <list_item>
                        <paragraph>Translations are always available after installation.</paragraph>
                    </list_item>
                </bullet_list>
                <paragraph>Cons:</paragraph>
                <bullet_list bullet="-">
                    <list_item>
                        <paragraph>This can mean a complex integration with Transifex</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>This can mean a lengthy manual PR review process up to a month such as in
                            the following example:
                            <reference name="Added French (Canada) and Japanese - xblock-drag-and-drop-v2 #220" refuri="https://github.com/openedx/xblock-drag-and-drop-v2/pull/220">Added French (Canada) and Japanese - xblock-drag-and-drop-v2 #220</reference></paragraph>
                    </list_item>
                </bullet_list>
            </section>
            <section dupnames="xblocki18nservice" ids="xblocki18nservice">
                <title>XBlockI18nService</title>
                <paragraph>The <reference name="XBlockI18nService" refuri="https://github.com/openedx/edx-platform/blob/6e28ba329e0a5354d7264ea834861bf0cae4ceb3/xmodule/modulestore/django.py#L359-L395">XBlockI18nService</reference> loads translations for installed XBlocks via its
                    <literal>__init__</literal> method. XBlock translations are only used during the
                    during the execution of the XBlock.</paragraph>
                <paragraph>The <reference name="XBlockI18nService implementation pull request" refuri="https://github.com/openedx/edx-platform/pull/11575/files#diff-0bbcc6c13d9bfc9d88fbe2fdf4fd97f6066a7a0f0bfffb82bc942378b7cf33e0R248">XBlockI18nService implementation pull request</reference> (2016) introduced
                    support for XBlock translations in <literal>edx-platform</literal> and has the full
                    context of the implementation.</paragraph>
                <target refid="js-translations"></target>
            </section>
            <section ids="javascript-translations-for-xbocks js-translations" names="javascript\ translations\ for\ xbocks js-translations">
                <title>JavaScript Translations for XBocks</title>
                <paragraph>As of September 2023, there is no centralized method to bundle JavaScript
                    translations in XBlocks. Non-XBlock plugins lack JavaScript translation
                    support altogether.</paragraph>
                <paragraph>The de-facto standard method for bundling JavaScript translations in XBlocks
                    is to use <literal>web_fragment</literal> and load the translations as part of the XBlock
                    frontend static files on every XBlock load.</paragraph>
                <paragraph>The LTI Consumer XBlock embeds the translations in its <literal>web_fragment</literal> via
                    the <reference name="LtiConsumerXBlock._get_statici18n_js_url" refuri="https://github.com/openedx/xblock-lti-consumer/blob/7a142310a78ac393286c1e9e77c535ea520ab90b/lti_consumer/lti_xblock.py#L663-L677">LtiConsumerXBlock._get_statici18n_js_url</reference> and
                    <reference name="LtiConsumerXBlock.student_view" refuri="https://github.com/openedx/xblock-lti-consumer/blob/7a142310a78ac393286c1e9e77c535ea520ab90b/lti_consumer/lti_xblock.py#L1215C24-L1217">LtiConsumerXBlock.student_view</reference> methods.</paragraph>
                <paragraph>In order to separate the XBlock translations from the platform, it’s isolated
                    in a separate <literal>gettext</literal> namespace. For example, the Drag and Drop XBlock
                    namespace is <literal>DragAndDropI18N</literal> which is hardcoded in multiple places such
                    as:</paragraph>
                <bullet_list bullet="-">
                    <list_item>
                        <paragraph><reference name="XBlock Makefile compile_translations rule" refuri="https://github.com/openedx/xblock-drag-and-drop-v2/blob/66e8d3517fe8c0db55c1a3907ff253c2a4562a7e/Makefile#L41">XBlock Makefile compile_translations rule</reference></paragraph>
                    </list_item>
                    <list_item>
                        <paragraph><reference name="XBlock compiled JavaScript text.js translations" refuri="https://github.com/openedx/xblock-drag-and-drop-v2/blob/b8ab1ecd9168ab1dba21f994ee4bfedb6a57d11f/drag_and_drop_v2/public/js/translations/tr/text.js#L3">XBlock compiled JavaScript text.js translations</reference></paragraph>
                    </list_item>
                    <list_item>
                        <paragraph><reference name="XBlock main JavaScript file" refuri="https://github.com/openedx/xblock-drag-and-drop-v2/blob/b8ab1ecd9168ab1dba21f994ee4bfedb6a57d11f/drag_and_drop_v2/public/js/drag_and_drop.js#L6">XBlock main JavaScript file</reference></paragraph>
                    </list_item>
                </bullet_list>
                <paragraph><reference name="OEP-58" refuri="https://open-edx-proposals.readthedocs.io/en/latest/architectural-decisions/oep-0058-arch-translations-management.html#specification">OEP-58</reference> does not change this structure, it just makes the necessary changes
                    to pull translations from the <reference name="openedx-translations repo" refuri="https://github.com/openedx/openedx-translations">openedx-translations repo</reference> via <literal>atlas</literal>
                    instead of having them live in the XBlock repository itself.</paragraph>
            </section>
        </section>
        <section ids="decisions" names="decisions">
            <title>Decisions</title>
            <section ids="proposed-design-for-edx-platform-conf-locale-translations" names="proposed\ design\ for\ edx\ platform\ conf/locale\ translations">
                <title>Proposed Design for edX Platform <literal>conf/locale</literal> translations</title>
                <paragraph>We’re going to use <literal>atlas</literal> in <literal>make pull_translations</literal> like we do in
                    <reference name="course-discovery atlas integration" refuri="https://github.com/openedx/course-discovery/pull/4037">course-discovery atlas integration</reference> and
                    <reference name="frontend-app-learning atlas integration" refuri="https://github.com/openedx/frontend-app-learning/pull/1093">frontend-app-learning atlas integration</reference>.</paragraph>
            </section>
            <section ids="proposed-design-for-xblocks-and-plugins" names="proposed\ design\ for\ xblocks\ and\ plugins">
                <title>Proposed Design for XBlocks and Plugins</title>
                <paragraph>Instead of storing translation files for each XBlock and Plugin in their
                    respective repositories,
                    we will use <reference name="openedx-atlas" refuri="https://github.com/openedx/openedx-atlas">openedx-atlas</reference> to pull them from the
                    <reference name="openedx-translations repo" refuri="https://github.com/openedx/openedx-translations">openedx-translations repo</reference>.</paragraph>
                <section ids="new-pull-xblock-translations-commands" names="new\ pull_xblock_translations\ commands">
                    <title>New <literal>pull_xblock_translations</literal> commands</title>
                    <paragraph>Introduce new Django command to the <literal>edx-platform</literal>:</paragraph>
                    <bullet_list bullet="-">
                        <list_item>
                            <paragraph><literal>manage.py lms pull_xblock_translations</literal>: This command
                                will pull translations for installed XBlocks and Plugins by module name:</paragraph>
                            <literal_block force="False" language="default" linenos="False" xml:space="preserve">$ atlas pull --expand-glob \
    'translations/*/drag_and_drop_v2/conf/locale:conf/plugins-locale/drag_and_drop_v2' \
    'translations/*/done/conf/locale:conf/plugins-locale/done' \
    'translations/*/edx_proctoring/conf/locale:conf/plugins-locale/edx_proctoring'</literal_block>
                            <paragraph>Resulting in the following file tree:</paragraph>
                            <literal_block force="False" language="default" linenos="False" xml:space="preserve">$ tree conf/plugins-locale/
conf/plugins-locale/
├── done
│   ├── ar
│   │   └── LC_MESSAGES
│   │       └── django.po
│   ├── de
│   │   └── LC_MESSAGES
│   │       └── django.po
│   ├── en
│   │   └── LC_MESSAGES
│   │       └── django.po
│   └── fr_CA
│       └── LC_MESSAGES
│           └── django.po
├── drag_and_drop_v2
│   ├── ar
│   │   └── LC_MESSAGES
│   │       └── django.po
│   ├── en
│   │   └── LC_MESSAGES
│   │       └── django.po
│   └── fr_CA
│       └── LC_MESSAGES
│           └── django.po
└── edx_proctoring
    ├── ar
    │   └── LC_MESSAGES
    │       └── djangojs.po
    ├── de
    │   └── LC_MESSAGES
    │       └── djangojs.po
    ├── en
    │   └── LC_MESSAGES
    │       ├── djangojs.po
    │       └── django.po
    └── fr_CA
        └── LC_MESSAGES
            ├── djangojs.po
            └── django.po</literal_block>
                        </list_item>
                    </bullet_list>
                </section>
                <section ids="using-xblock-python-module-names-instead-of-repository-names" names="using\ xblock\ python\ module\ names\ instead\ of\ repository\ names">
                    <title>Using XBlock python module names instead of repository names</title>
                    <paragraph>There’s more than one identifier for XBlocks and Plugins:</paragraph>
                    <enumerated_list enumtype="arabic" prefix="" suffix=".">
                        <list_item>
                            <paragraph><strong>The XBlock/plugin tag:</strong> Python plugins have an entry point name which
                                is referred to as <literal>tag</literal> in Open edX. For example, the
                                tag in the <reference name="Drag and Drop XBlock setup.py file" refuri="https://github.com/openedx/xblock-drag-and-drop-v2/blame/192ecfc603a2314b2cb1105ebc7ba6991e459250/setup.py#L127-L129">Drag and Drop XBlock setup.py file</reference> is <literal>drag-and-drop-v2</literal>:</paragraph>
                            <literal_block force="False" language="default" linenos="False" xml:space="preserve"># xblock-drag-and-drop-v2/setup.py
entry_points={
    'xblock.v1': 'drag-and-drop-v2 = drag_and_drop_v2:DragAndDropBlock',
}</literal_block>
                        </list_item>
                        <list_item>
                            <paragraph><strong>The git repository name:</strong> Each XBlock has a unique git repository name.
                                For example, the Drag and Drop XBlock has the <literal>xblock-drag-and-drop-v2</literal>
                                repository name in GitHub: <reference refuri="https://github.com/openedx/xblock-drag-and-drop-v2/">https://github.com/openedx/xblock-drag-and-drop-v2/</reference></paragraph>
                        </list_item>
                        <list_item>
                            <paragraph><strong>Python module name:</strong> The python module name appears in the path of
                                XBlock translations in the <reference name="openedx-translations repo" refuri="https://github.com/openedx/openedx-translations">openedx-translations repo</reference>. For example,
                                the Drag and Drop XBlock will have <literal>drag_and_drop_v2</literal> python module name
                                in the translations directory structure:</paragraph>
                            <literal_block force="False" language="default" linenos="False" xml:space="preserve">translations/xblock-drag-and-drop-v2/drag_and_drop_v2/conf/locale/...</literal_block>
                        </list_item>
                    </enumerated_list>
                    <paragraph>The <literal>pull_xblock_translations</literal> command will use the Python module name
                        instead of the repository name to pull translations from the
                        <reference name="openedx-translations repo" refuri="https://github.com/openedx/openedx-translations">openedx-translations repo</reference> via <literal>atlas</literal>.</paragraph>
                    <paragraph>Using the Python module name has the following pros and cons:</paragraph>
                    <paragraph><strong>Pros:</strong></paragraph>
                    <bullet_list bullet="-">
                        <list_item>
                            <paragraph>The python module name is available without needing to install the XBlock,
                                or parse the <literal>setup.py</literal> file.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>It is available in Python runtime.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>It is available in the <reference name="openedx-translations repo" refuri="https://github.com/openedx/openedx-translations">openedx-translations repo</reference>
                                file structure.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>It is unique in the virtual environment which prevents
                                collisions.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>The python module name of XBlocks doesn’t change often if at all.</paragraph>
                        </list_item>
                    </bullet_list>
                    <paragraph><strong>Cons:</strong></paragraph>
                    <bullet_list bullet="-">
                        <list_item>
                            <paragraph>The python module name can be confused as the XBlock tag, which can
                                be different in some XBlocks.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>The unique and stable identifier of XBlocks is the tag, not the
                                python module name. Therefore, this decision will implicitly make
                                the python module name another unique identifier for XBlocks.</paragraph>
                        </list_item>
                    </bullet_list>
                    <paragraph>The trade-offs are acceptable and this decision is reversible in case
                        the <literal>xblock.tag</literal> needs to be used. However, this will require parsing
                        the <literal>setup.py</literal> file and/or installing the XBlock in order to get the tag
                        in the <reference name="extract-translation-source-files.yml" refuri="https://github.com/openedx/openedx-translations/blob/2566e0c9a30d033e5dd8d05d4c12601c8e37b4ef/.github/workflows/extract-translation-source-files.yml#L36-L43">extract-translation-source-files.yml</reference> workflow in the
                        <reference name="openedx-translations repo" refuri="https://github.com/openedx/openedx-translations">openedx-translations repo</reference>.</paragraph>
                </section>
                <section ids="using-the-django-and-djangojs-gettext-domains" names="using\ the\ django\ and\ djangojs\ gettext\ domains">
                    <title>Using the <literal>django</literal> and <literal>djangojs</literal> gettext domains</title>
                    <paragraph>This proposal standardizes the gettext domain for XBlocks and Plugins to
                        <literal>django</literal> and <literal>djangojs</literal>. This helps to unify the file names and avoid the
                        need to add more complexity to the <reference name="openedx-translations repo" refuri="https://github.com/openedx/openedx-translations">openedx-translations repo</reference> tooling.</paragraph>
                    <paragraph>The <reference name="DjangoTranslation class" refuri="https://github.com/django/django/blob/594873befbbec13a2d9a048a361757dd3cf178da/django/utils/translation/trans_real.py#L155-L161">DjangoTranslation class</reference> doesn’t allow customizing the locale
                        directory for <literal>django.mo</literal> files for caching reasons. Therefore,
                        the <reference name="GNUTranslations class" refuri="https://github.com/python/cpython/blob/b4144979934d7b8448f80c1fbee65dc3bfbce005/Lib/gettext.py#L528-L532">GNUTranslations class</reference> will be used instead in the
                        <literal>create_js_namespaced_catalog</literal> helper function for generating
                        JavaScript catalogs from <literal>django.mo</literal> files.</paragraph>
                </section>
                <section ids="blocki18nservice-support-for-atlas-python-translations" names="blocki18nservice\ support\ for\ atlas\ python\ translations">
                    <title>BlockI18nService support for <literal>atlas</literal> Python translations</title>
                    <paragraph><literal>get_python_locale_directory</literal> will support two modes:</paragraph>
                    <enumerated_list enumtype="arabic" prefix="" suffix=".">
                        <list_item>
                            <paragraph>If translations for the XBlock/plugin has been pulled by <literal>atlas</literal>
                                from the <reference name="openedx-translations repo" refuri="https://github.com/openedx/openedx-translations">openedx-translations repo</reference>, it will be used. For example, if the
                                <literal>edx-platform/conf/plugins-locale/drag_and_drop_v2/ar/LC_MESSAGES/django.po</literal>
                                path exists, it will be used for the Drag and Drop XBlock.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>Otherwise, the bundled translation files in the XBlock packages will be
                                used. The fallback path for the Drag and Drop XBlock will be
                                <literal>lib/python3.8/site-packages/drag_and_drop_v2/translations/ar/LC_MESSAGES/text.po</literal>.</paragraph>
                        </list_item>
                    </enumerated_list>
                    <paragraph>This fallback is used to maintain backwards compatibility with existing
                        XBlocks that may or may not be included in the <reference name="openedx-translations repo" refuri="https://github.com/openedx/openedx-translations">openedx-translations repo</reference>.
                        Third-party XBlocks that are not included in the
                        <reference name="xblocks Transifex project" refuri="https://www.transifex.com/open-edx/xblocks/">xblocks Transifex project</reference>, such as the <reference name="Lime Survey XBlock" refuri="https://github.com/eduNEXT/xblock-limesurvey">Lime Survey XBlock</reference>,
                        will benefit from this backwards compatibility.</paragraph>
                </section>
                <section ids="new-compile-xblock-translations-command" names="new\ compile_xblock_translations\ command">
                    <title>New <literal>compile_xblock_translations</literal> command</title>
                    <paragraph>An <literal>XBlock.i18n_js_namespace</literal> property will be added for
                        the <literal>compile_xblock_translations</literal> to generate JavaScript translations
                        in a centrally managed manner for installed XBlocks.</paragraph>
                    <paragraph>A <literal>compile_xblock_translations</literal> command will loop over XBlock
                        modules that has the <literal>i18n_js_namespace</literal>
                        property set and compile the JavaScript translations via the <reference name="compilejsi18n" refuri="https://django-statici18n.readthedocs.io/en/latest/commands.html#compilejsi18n">compilejsi18n</reference>
                        command.</paragraph>
                    <paragraph>For example if the Drag and Drop XBlock has
                        <literal>i18n_js_namespace = 'DragAndDropI18N'</literal>, the
                        <literal>compile_xblock_translations</literal> command will execute the equivalent of the following commands:</paragraph>
                    <literal_block force="False" language="default" linenos="False" xml:space="preserve">i18n_tool generate -v  # Generate the .mo files
python manage.py compilejsi18n --namespace DragAndDropI18N --output conf/plugins-locale/drag_and_drop_v2/js/</literal_block>
                </section>
                <section ids="xblocki18nservice-support-for-atlas-javascript-translations" names="xblocki18nservice\ support\ for\ atlas\ javascript\ translations">
                    <title>XBlockI18nService support for <literal>atlas</literal> JavaScript translations</title>
                    <paragraph>A <literal>get_javascript_locale_path</literal> method will be added to the
                        <literal>XBlockI18nService</literal> to provide XBlocks the
                        appropriate path to <literal>django.js</literal> translation files. This method
                        will allow XBlocks to utilize legacy packaged translations
                        or <literal>atlas</literal>.</paragraph>
                    <paragraph>A <literal>i18n_js_namespace</literal> property will be added
                        to generate JavaScript translations in a centrally managed manner for all
                        XBlocks as described in the <reference internal="True" refid="js-translations"><inline classes="std std-ref">JavaScript Translations for XBocks</inline></reference> section.</paragraph>
                    <paragraph>For example, the <reference name="Drag and Drop XBlock get_static_i18n_js_url" refuri="https://github.com/openedx/xblock-drag-and-drop-v2/blob/66e8d3517fe8c0db55c1a3907ff253c2a4562a7e/drag_and_drop_v2/drag_and_drop_v2.py#L318-L332">Drag and Drop XBlock get_static_i18n_js_url</reference> will need to
                        be updated to support the new <literal>XBlockI18nService</literal>
                        <literal>get_javascript_i18n_catalog_url</literal> method and the namespace.</paragraph>
                    <literal_block force="False" highlight_args="{}" language="diff" linenos="False" xml:space="preserve">  class DragAndDropBlock(XBlock):

+   i18n_js_namespace = 'DragAndDropI18N'

    @staticmethod
    def _get_statici18n_js_url():
        """
        Returns the Javascript translation file for the currently selected language, if any found by
        `pkg_resources`
        """
        lang_code = translation.get_language()
        if not lang_code:
            return None

+       # TODO: Make this the default once OEP-58 is implemented.
+       if hasattr(self.i18n_service, 'get_javascript_i18n_catalog_url'):
+           i18n_catalog_url = self.i18n_service.get_javascript_i18n_catalog_url()
+           if i18n_catalog_url:
+               return i18n_catalog_url

        text_js = 'public/js/translations/{lang_code}/text.js'
        country_code = lang_code.split('-')[0]
        for code in (translation.to_locale(lang_code), lang_code, country_code):
            if pkg_resources.resource_exists(loader.module_name, text_js.format(lang_code=code)):
                return text_js.format(lang_code=code)
        return None</literal_block>
                </section>
            </section>
        </section>
        <section ids="dismissed-proposals" names="dismissed\ proposals">
            <title>Dismissed Proposals</title>
            <section ids="xblocks-and-plugins-have-their-own-atlas-pull-command" names='xblocks\ and\ plugins\ have\ their\ own\ "atlas\ pull"\ command'>
                <title>XBlocks and plugins have their own “atlas pull” command</title>
                <paragraph>This dismissed proposal intends to have each XBlock and Plugin have their
                    own <literal>make pull_translations</literal> and be responsible for managing pulling their
                    own translations from the <reference name="openedx-translations repo" refuri="https://github.com/openedx/openedx-translations">openedx-translations repo</reference>.</paragraph>
                <paragraph>This proposal has been dismissed because it would require substantial work
                    to get into the details for the <literal>lib/python3.8/site-packages/</literal> directory
                    and ensure that the <literal>make pull_translations</literal> command won’t corrupt the
                    virtual environment.</paragraph>
                <paragraph>This is a non-trivial task and appears to add more complexity than necessary
                    due to the fact that XBlocks and plugins won’t be used outside the
                    context of <literal>edx-platform</literal>.</paragraph>
            </section>
        </section>
        <section ids="goals" names="goals">
            <title>Goals</title>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>Use <literal>atlas pull</literal> for the <literal>edx-platform</literal> repo.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Use <literal>atlas pull</literal> for the XBlocks and Plugins.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Allow Tutor and other advanced uses to craft their own <literal>atlas pull</literal>
                        commands by making the the plugins list available via Django commands.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Allow <literal>atlas pull</literal> to use the Python module names instead of the
                        repository name of XBlocks and Plugins which is supported via the
                        <reference name="atlas pull --expand-glob" refuri="https://github.com/openedx/openedx-atlas/blob/main/docs/decisions/0001-support-glob-pattern.rst">atlas pull –expand-glob</reference> option.</paragraph>
                </list_item>
            </enumerated_list>
            <target refid="non-goals"></target>
        </section>
        <section dupnames="non-goals" ids="non-goals id1" names="non-goals">
            <title>Non-Goals</title>
            <paragraph>The following are non-goals for this proposal, although some are going to
                be tackled in the future as part of the
                <reference name="Translation Management update OEP-58" refuri="https://open-edx-proposals.readthedocs.io/en/latest/architectural-decisions/oep-0058-arch-translations-management.html#specification">Translation Management update OEP-58</reference> proposal.</paragraph>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>Provide a fool-proof method for managing named-release translations.
                        This will be a separate discussion.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Discuss the merge/segment strategy of the <literal>edx-platform</literal>. This is being
                        discussed in the
                        <reference name="decision no. 0018" refuri="https://github.com/openedx/edx-platform/pull/32994">decision no. 0018</reference><target ids="decision-no-0018" names="decision\ no.\ 0018" refuri="https://github.com/openedx/edx-platform/pull/32994"></target>.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Design a new XBlock frontend architecture. Instead this proposal works
                        with the existing architecture.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Provide a new translation method for theme translations. This will be
                        tackled later on.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Provide a new translation method for non-XBlock plugins such as
                        <literal>edx-val</literal>. This will be tackled later on as part of the <reference name="OEP-58" refuri="https://open-edx-proposals.readthedocs.io/en/latest/architectural-decisions/oep-0058-arch-translations-management.html#specification">OEP-58</reference>
                        proposal.</paragraph>
                </list_item>
            </enumerated_list>
            <target ids="oep-58-specifications" names="oep-58\ specifications" refuri="https://open-edx-proposals.readthedocs.io/en/latest/architectural-decisions/oep-0058-arch-translations-management.html#specification"></target>
            <target ids="translation-management-update-oep-58" names="translation\ management\ update\ oep-58" refuri="https://open-edx-proposals.readthedocs.io/en/latest/architectural-decisions/oep-0058-arch-translations-management.html#specification"></target>
            <target ids="oep-58" names="oep-58" refuri="https://open-edx-proposals.readthedocs.io/en/latest/architectural-decisions/oep-0058-arch-translations-management.html#specification"></target>
            <target ids="openedx-atlas" names="openedx-atlas" refuri="https://github.com/openedx/openedx-atlas"></target>
            <target ids="openedx-translations-repo" names="openedx-translations\ repo" refuri="https://github.com/openedx/openedx-translations"></target>
            <target ids="extract-translation-source-files-yml" names="extract-translation-source-files.yml" refuri="https://github.com/openedx/openedx-translations/blob/2566e0c9a30d033e5dd8d05d4c12601c8e37b4ef/.github/workflows/extract-translation-source-files.yml#L36-L43"></target>
            <target ids="openedx-translations-transifex-project" names="openedx-translations\ transifex\ project" refuri="https://app.transifex.com/open-edx/openedx-translations/dashboard/"></target>
            <target ids="approach-memo-and-technical-discovery-translations-infrastructure-implementation" names="approach\ memo\ and\ technical\ discovery\ -\ translations\ infrastructure\ implementation" refuri="https://docs.google.com/document/d/11dFBCnbdHiCEdZp3pZeHdeH8m7Glla-XbIin7cnIOzU/edit"></target>
            <target ids="added-french-canada-and-japanese-xblock-drag-and-drop-v2-220" names="added\ french\ (canada)\ and\ japanese\ -\ xblock-drag-and-drop-v2\ #220" refuri="https://github.com/openedx/xblock-drag-and-drop-v2/pull/220"></target>
            <target ids="id2" names="xblocki18nservice" refuri="https://github.com/openedx/edx-platform/blob/6e28ba329e0a5354d7264ea834861bf0cae4ceb3/xmodule/modulestore/django.py#L359-L395"></target>
            <target ids="xblocki18nservice-implementation-pull-request" names="xblocki18nservice\ implementation\ pull\ request" refuri="https://github.com/openedx/edx-platform/pull/11575/files#diff-0bbcc6c13d9bfc9d88fbe2fdf4fd97f6066a7a0f0bfffb82bc942378b7cf33e0R248"></target>
            <target ids="course-discovery-atlas-integration" names="course-discovery\ atlas\ integration" refuri="https://github.com/openedx/course-discovery/pull/4037"></target>
            <target ids="frontend-app-learning-atlas-integration" names="frontend-app-learning\ atlas\ integration" refuri="https://github.com/openedx/frontend-app-learning/pull/1093"></target>
            <target ids="edx-platform-pull-translations" names="edx-platform\ pull_translations" refuri="https://github.com/openedx/edx-platform/blob/0137881b8199701b2af7d07c9a01200e358e3d86/Makefile#L55-L64"></target>
            <target ids="drag-and-drop-v2-xblock" names="drag-and-drop-v2\ xblock" refuri="https://github.com/openedx/xblock-drag-and-drop-v2/"></target>
            <target ids="lti-consumer-xblock" names="lti\ consumer\ xblock" refuri="https://github.com/openedx/xblock-lti-consumer/"></target>
            <target ids="edx-val" names="edx-val" refuri="https://github.com/openedx/edx-val"></target>
            <target ids="lticonsumerxblock-get-statici18n-js-url" names="lticonsumerxblock._get_statici18n_js_url" refuri="https://github.com/openedx/xblock-lti-consumer/blob/7a142310a78ac393286c1e9e77c535ea520ab90b/lti_consumer/lti_xblock.py#L663-L677"></target>
            <target ids="lticonsumerxblock-student-view" names="lticonsumerxblock.student_view" refuri="https://github.com/openedx/xblock-lti-consumer/blob/7a142310a78ac393286c1e9e77c535ea520ab90b/lti_consumer/lti_xblock.py#L1215C24-L1217"></target>
            <target ids="drag-and-drop-xblock-get-static-i18n-js-url" names="drag\ and\ drop\ xblock\ get_static_i18n_js_url" refuri="https://github.com/openedx/xblock-drag-and-drop-v2/blob/66e8d3517fe8c0db55c1a3907ff253c2a4562a7e/drag_and_drop_v2/drag_and_drop_v2.py#L318-L332"></target>
            <target ids="xblock-compiled-javascript-text-js-translations" names="xblock\ compiled\ javascript\ text.js\ translations" refuri="https://github.com/openedx/xblock-drag-and-drop-v2/blob/b8ab1ecd9168ab1dba21f994ee4bfedb6a57d11f/drag_and_drop_v2/public/js/translations/tr/text.js#L3"></target>
            <target ids="xblock-makefile-compile-translations-rule" names="xblock\ makefile\ compile_translations\ rule" refuri="https://github.com/openedx/xblock-drag-and-drop-v2/blob/66e8d3517fe8c0db55c1a3907ff253c2a4562a7e/Makefile#L41"></target>
            <target ids="xblock-main-javascript-file" names="xblock\ main\ javascript\ file" refuri="https://github.com/openedx/xblock-drag-and-drop-v2/blob/b8ab1ecd9168ab1dba21f994ee4bfedb6a57d11f/drag_and_drop_v2/public/js/drag_and_drop.js#L6"></target>
            <target ids="translations-xblock-drag-and-drop-v2-directory" names="translations/xblock-drag-and-drop-v2\ directory" refuri="https://github.com/openedx/openedx-translations/tree/8a01424fd8f42e9e76aed34e235c82ab654cdfc5/translations/xblock-drag-and-drop-v2"></target>
            <target ids="atlas-pull-expand-glob" names="atlas\ pull\ --expand-glob" refuri="https://github.com/openedx/openedx-atlas/blob/main/docs/decisions/0001-support-glob-pattern.rst"></target>
            <target ids="compilejsi18n" names="compilejsi18n" refuri="https://django-statici18n.readthedocs.io/en/latest/commands.html#compilejsi18n"></target>
            <target ids="transifex-translation-memory" names="transifex\ translation\ memory" refuri="https://help.transifex.com/en/articles/6224636-introduction-to-translation-memory"></target>
            <target ids="edx-platform-transifex-project" names="edx-platform\ transifex\ project" refuri="https://www.transifex.com/open-edx/edx-platform/"></target>
            <target ids="xblocks-transifex-project" names="xblocks\ transifex\ project" refuri="https://www.transifex.com/open-edx/xblocks/"></target>
            <target ids="lime-survey-xblock" names="lime\ survey\ xblock" refuri="https://github.com/eduNEXT/xblock-limesurvey"></target>
            <target ids="drag-and-drop-xblock-setup-py-file" names="drag\ and\ drop\ xblock\ setup.py\ file" refuri="https://github.com/openedx/xblock-drag-and-drop-v2/blame/192ecfc603a2314b2cb1105ebc7ba6991e459250/setup.py#L127-L129"></target>
            <target ids="djangotranslation-class" names="djangotranslation\ class" refuri="https://github.com/django/django/blob/594873befbbec13a2d9a048a361757dd3cf178da/django/utils/translation/trans_real.py#L155-L161"></target>
            <target ids="gnutranslations-class" names="gnutranslations\ class" refuri="https://github.com/python/cpython/blob/b4144979934d7b8448f80c1fbee65dc3bfbce005/Lib/gettext.py#L528-L532"></target>
        </section>
    </section>
</document>
