<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.21.2 -->
<document source="/Users/sarinacanelake/openedx/edx-platform/docs/decisions/0004-managing-django-settings.rst" translation_progress="{'total': 0, 'translated': 0}" xmlns:c="https://www.sphinx-doc.org/" xmlns:changeset="https://www.sphinx-doc.org/" xmlns:citation="https://www.sphinx-doc.org/" xmlns:cpp="https://www.sphinx-doc.org/" xmlns:http="https://www.sphinx-doc.org/" xmlns:index="https://www.sphinx-doc.org/" xmlns:js="https://www.sphinx-doc.org/" xmlns:math="https://www.sphinx-doc.org/" xmlns:py="https://www.sphinx-doc.org/" xmlns:rst="https://www.sphinx-doc.org/" xmlns:std="https://www.sphinx-doc.org/">
    <section ids="status" names="status">
        <title>Status</title>
        <paragraph>Provisional</paragraph>
    </section>
    <section ids="context" names="context">
        <title>Context</title>
        <paragraph>Settings are confusing right now and there are way too many layers. We have
            multiple python settings file that “inherit” from each other. In some cases some
            layers of the inheritance tree also pull settings from config files leading to
            more confusion.</paragraph>
    </section>
    <section ids="decision" names="decision">
        <title>Decision</title>
        <paragraph>Rather than having multiple python settings files that override things
            differently we will move to just a few python files with most of the settings
            variance living in YAML config files that are managed by environment operators.
            The structure of these files try to match <title_reference>OEP-45</title_reference> as bast as we can. Because
            the edx-platform houses both the <literal>LMS</literal> and <literal>Studio</literal> applications, our
            implementation will differ slightly from the guidance provided by <title_reference>OEP-45</title_reference>.</paragraph>
        <paragraph>LMS and CMS settings will continue to live under <literal>lms/envs/...</literal> and <literal>cms/envs/...</literal>.</paragraph>
        <paragraph>Underneath those folders, we will follow the layout suggested by <title_reference>OEP-45</title_reference>.</paragraph>
        <paragraph>To recap that here:</paragraph>
        <paragraph><literal>__init__.py</literal> will handle the loading of defaults, environment overrides, and ensuring that required settings are set.</paragraph>
        <paragraph><literal>defaults.py</literal> will house and document all default settings.</paragraph>
        <paragraph><literal>required.py</literal> will document and validate that required settings have been defined.</paragraph>
        <paragraph>For edx-platform there may be cases where settings are additive, in this case
            the managing of those additive settings will be managed within
            <literal>__init__.py</literal></paragraph>
        <paragraph>For example, FEATURES, or JWT_AUTH are both settings where we
            currently pull parts of the data from the config and inject it into an existing
            data structure. While it is possible that in the future we would make these be
            more explicit, we don’t want to take on that work now as it may increase
            complexity.</paragraph>
        <target ids="oep-45" names="oep-45" refuri="https://github.com/openedx/open-edx-proposals/pull/143/files"></target>
    </section>
    <section ids="consequences" names="consequences">
        <title>Consequences</title>
        <paragraph>Rather than having both python and yaml override files for our dev and test
            environments, we will move towards having all settings defined in a yaml file
            and for all environments to use __init__.py to load their settings.</paragraph>
        <paragraph>The following files should be obviated by this change:</paragraph>
        <bullet_list bullet="*">
            <list_item>
                <paragraph>bok_choy_docker.py</paragraph>
            </list_item>
            <list_item>
                <paragraph>devstack_docker.py</paragraph>
            </list_item>
            <list_item>
                <paragraph>devstack_optimized.py</paragraph>
            </list_item>
            <list_item>
                <paragraph>devstack.py</paragraph>
            </list_item>
            <list_item>
                <paragraph>devstack_with_worker.py</paragraph>
            </list_item>
            <list_item>
                <paragraph>load_test.py</paragraph>
            </list_item>
            <list_item>
                <paragraph>openstack.py</paragraph>
            </list_item>
            <list_item>
                <paragraph>static.py</paragraph>
            </list_item>
            <list_item>
                <paragraph>test.py</paragraph>
            </list_item>
            <list_item>
                <paragraph>test_static_optimized.py</paragraph>
            </list_item>
        </bullet_list>
        <paragraph>If there exist default YAML files for any of the above environments they should
            be updated to absorb any overrides that lived in these python settings files.
            Any environments that use these files should be updated.</paragraph>
    </section>
    <section ids="alternatives-considered" names="alternatives\ considered">
        <title>Alternatives Considered</title>
        <section ids="don-t-use-yaml-files-just-python-modules" names="don't\ use\ yaml\ files,\ just\ python\ modules">
            <title>Don’t use YAML files, just python modules</title>
            <paragraph>Instead of having YAML and then translating that to python, we can just have
                python settings files for all variants we want.</paragraph>
            <paragraph>Pros:</paragraph>
            <bullet_list bullet="*">
                <list_item>
                    <paragraph>Settings can still be in a single place per environment.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>You get the full power of python when building out settings.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Settings values can be complex python objects.</paragraph>
                </list_item>
            </bullet_list>
            <paragraph>Cons:
                * Because settings have secrets, we would have to keep our settings file out of</paragraph>
            <block_quote>
                <paragraph>the public repository.</paragraph>
            </block_quote>
            <bullet_list bullet="*">
                <list_item>
                    <paragraph>This wouldn’t solve the problem where we would still try to “inherit” from other settings files and make it harder to read the current value of any given setting.</paragraph>
                </list_item>
            </bullet_list>
            <paragraph>This alternative gives us a lot more power but it’s power that we don’t actually need.  Building limitiations into what settings can be helps us keep them simple and understandable.</paragraph>
        </section>
    </section>
</document>
