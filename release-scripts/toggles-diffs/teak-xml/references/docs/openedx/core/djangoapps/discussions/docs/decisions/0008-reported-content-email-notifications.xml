<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.21.2 -->
<document source="/Users/sarinacanelake/openedx/edx-platform/docs/references/docs/openedx/core/djangoapps/discussions/docs/decisions/0008-reported-content-email-notifications.rst" translation_progress="{'total': 0, 'translated': 0}" xmlns:c="https://www.sphinx-doc.org/" xmlns:changeset="https://www.sphinx-doc.org/" xmlns:citation="https://www.sphinx-doc.org/" xmlns:cpp="https://www.sphinx-doc.org/" xmlns:http="https://www.sphinx-doc.org/" xmlns:index="https://www.sphinx-doc.org/" xmlns:js="https://www.sphinx-doc.org/" xmlns:math="https://www.sphinx-doc.org/" xmlns:py="https://www.sphinx-doc.org/" xmlns:rst="https://www.sphinx-doc.org/" xmlns:std="https://www.sphinx-doc.org/">
    <section ids="reported-content-email-notifications-for-moderators" names="reported\ content\ email\ notifications\ for\ moderators">
        <title>Reported content email notifications for moderators</title>
        <section ids="status" names="status">
            <title>Status</title>
            <paragraph>Proposal</paragraph>
        </section>
        <section ids="context" names="context">
            <title>Context</title>
            <paragraph>We need to provide an option for quick visibility of reported content for
                moderators. We plan to implement this by adding an option to send out an
                email to discussion moderators when a content (post/response/comment) is
                reported. This email will be sent out when a content is reported, and stays
                reported for the next 2 minutes.</paragraph>
            <paragraph>The email should be sent to all roles that have discussion moderation
                privileges, namely Discussion Admin, Discussion Moderator, Community TA and
                Group Community TA.</paragraph>
            <paragraph>Group community TAs will only receive for reported content in their own
                cohort.</paragraph>
            <paragraph>A toggle for this setting will be added on the edX discussions configuration
                page. This toggle can be turned on or off at any point of time,
                even if the course run is already in progress.</paragraph>
        </section>
        <section ids="requirements" names="requirements">
            <title>Requirements</title>
            <paragraph>We need to have the ability to enable/disable email notifications for reported
                content for a course.</paragraph>
            <paragraph>When a course content is reported the email needs to be sent only if the
                content remains reported for the next 2 minutes.</paragraph>
        </section>
        <section ids="decision" names="decision">
            <title>Decision</title>
            <paragraph>We need to have a toggle setting for courses to have the option to configure
                the email notifications for moderators. To achieve this, we will add a new
                field named <title_reference>reported_content_email_notifications</title_reference> to the
                <title_reference>CourseDiscussionSettings</title_reference> model and the default value for the field will be
                <title_reference>False</title_reference>. Course Team will have the option to toggle this through the
                discussions configuration page using the discussion settings endpoint.</paragraph>
            <paragraph>Furthermore, we also need to handle sending out the email notification to the
                moderators if the content remains reported for 2 minutes. To handle this, we
                will add a Celery task with a delay of 120 seconds. The task will first check
                if the content is still in the reported state, and then send an email to
                moderators.</paragraph>
            <paragraph>We will not retry sending a failed email attempt. A successful or failed
                attempt will be logged.</paragraph>
            <paragraph>Emails will be sent out from <reference refuri="mailto:edx@news.edx.org">edx@news.edx.org</reference></paragraph>
            <section ids="changes-to-coursediscussionsettings-model" names="changes\ to\ coursediscussionsettings\ model">
                <title>Changes to CourseDiscussionSettings Model</title>
                <literal_block force="False" highlight_args="{}" language="json" linenos="False" xml:space="preserve">class CourseDiscussionSettings(models.Model):
    ...
    reported_content_email_notifications=models.BooleanField(default=False)</literal_block>
            </section>
            <section ids="endpoint-to-toggle-the-notifications-settings" names="endpoint\ to\ toggle\ the\ notifications\ settings">
                <title>Endpoint to toggle the notifications settings</title>
                <paragraph>POST <literal>api/discussions/v0/course/{course_id}/settings</literal></paragraph>
                <literal_block force="False" highlight_args="{}" language="json" linenos="False" xml:space="preserve">{
    context_key: "{course_id}",
    ...
    plugin_configuration: {
        ...
        reported_content_email_notifications: true
    }
}</literal_block>
            </section>
        </section>
    </section>
</document>
