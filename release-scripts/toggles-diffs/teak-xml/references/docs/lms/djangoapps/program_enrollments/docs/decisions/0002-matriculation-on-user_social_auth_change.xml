<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.21.2 -->
<document source="/Users/sarinacanelake/openedx/edx-platform/docs/references/docs/lms/djangoapps/program_enrollments/docs/decisions/0002-matriculation-on-user_social_auth_change.rst" translation_progress="{'total': 0, 'translated': 0}" xmlns:c="https://www.sphinx-doc.org/" xmlns:changeset="https://www.sphinx-doc.org/" xmlns:citation="https://www.sphinx-doc.org/" xmlns:cpp="https://www.sphinx-doc.org/" xmlns:http="https://www.sphinx-doc.org/" xmlns:index="https://www.sphinx-doc.org/" xmlns:js="https://www.sphinx-doc.org/" xmlns:math="https://www.sphinx-doc.org/" xmlns:py="https://www.sphinx-doc.org/" xmlns:rst="https://www.sphinx-doc.org/" xmlns:std="https://www.sphinx-doc.org/">
    <section ids="matriculation-on-usersocialauth-changes" names="matriculation\ on\ usersocialauth\ changes">
        <title>Matriculation on UserSocialAuth Changes</title>
        <section ids="status" names="status">
            <title>Status</title>
            <paragraph>Accepted (circa October 2019)</paragraph>
        </section>
        <section ids="context" names="context">
            <title>Context</title>
            <paragraph>Georgia Tech has been enrolling learners into its Master’s programs
                for a long time, using enterprise-oriented APIs for the purpose. To
                transition them to using our Master’s-intended workflow, we’ve worked
                out a plan with them to convert existing <literal>UserSocialAuth</literal> records to use
                a different SAML-provided field as the canonical UID used elsewhere in
                our system to identify the learner for program enrollment
                purposes. Thus, we’ve already decided we’ll need a one-time management
                command to update these learners’ User SocialAuth records to use the
                new UID.</paragraph>
            <paragraph>The scope of this decision is a particular snag in how program
                enrollments are linked to learner accounts. Namely, this linking only
                occurs on the creation of a <literal>UserSocialAuth</literal> record, and not in
                response to the kind of update we’re proposing to perform with our
                management command.</paragraph>
        </section>
        <section ids="decisions" names="decisions">
            <title>Decisions</title>
            <paragraph>To address this concern and to achieve greater flexibility of program
                enrollments into the future, we will attempt to link program
                enrollments to learner accounts upon any change to a
                <literal>UserSocialAuth</literal> record, rather than solely on creation.</paragraph>
        </section>
        <section ids="consequences" names="consequences">
            <title>Consequences</title>
            <paragraph>This may have a performance impact, since updates to
                <literal>UserSocialAuth</literal> records happen often at times which would not
                benefit us. We anticipate this performance impact will be fairly
                minimal given the current indices on the table, however.</paragraph>
            <paragraph>This does enable us to keep the management command simple. It also
                enables us to re-trigger program enrollment linking on demand by
                making trivial changes to the <literal>UserSocialAuth</literal> record, which may be
                helpful for support purposes.</paragraph>
        </section>
        <section ids="alternatives" names="alternatives">
            <title>Alternatives</title>
            <paragraph>We also considered, but rejected the following possibilities:</paragraph>
            <enumerated_list enumtype="arabic" prefix="" suffix=")">
                <list_item>
                    <paragraph>Switch our <literal>post_save</literal> signal handler to <literal>pre_save</literal>, and diff
                        the model fields on updates to determine whether we’ve changed the
                        UID.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Make the management command more complex, and have it call the
                        program enrollment-linking code itself rather than relying on these
                        signals.</paragraph>
                </list_item>
            </enumerated_list>
        </section>
    </section>
</document>
