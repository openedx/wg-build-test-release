<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.21.2 -->
<document source="/Users/sarinacanelake/openedx/edx-platform/docs/references/docs/lms/djangoapps/certificates/docs/decisions/007-transfer-certificate-signatures-from-mongo.rst" translation_progress="{'total': 0, 'translated': 0}" xmlns:c="https://www.sphinx-doc.org/" xmlns:changeset="https://www.sphinx-doc.org/" xmlns:citation="https://www.sphinx-doc.org/" xmlns:cpp="https://www.sphinx-doc.org/" xmlns:http="https://www.sphinx-doc.org/" xmlns:index="https://www.sphinx-doc.org/" xmlns:js="https://www.sphinx-doc.org/" xmlns:math="https://www.sphinx-doc.org/" xmlns:py="https://www.sphinx-doc.org/" xmlns:rst="https://www.sphinx-doc.org/" xmlns:std="https://www.sphinx-doc.org/">
    <section ids="transfer-certificate-signatures-to-credentials-ida" names="transfer\ certificate\ signatures\ to\ credentials\ ida">
        <title>Transfer certificate signatures to Credentials IDA</title>
        <section ids="status" names="status">
            <title>Status</title>
            <paragraph>Accepted</paragraph>
        </section>
        <section ids="context" names="context">
            <title>Context</title>
            <paragraph>As a part of <reference name="Old Mongo Deprecation" refuri="https://github.com/openedx/public-engineering/issues/62">Old Mongo Deprecation</reference> work, we are planning to remove the support for c4x assets.
                After removing the support for c4x assets from the <literal>StaticContentServer</literal> middleware,
                the certificate signatures for <literal>Draft (Old) Mongo</literal> courses with deprecated IDs will become
                unavailable.</paragraph>
            <target ids="old-mongo-deprecation" names="old\ mongo\ deprecation" refuri="https://github.com/openedx/public-engineering/issues/62"></target>
        </section>
        <section ids="decision" names="decision">
            <title>Decision</title>
            <paragraph>We will transfer and store certificate signatures in <reference name="Credentials" refuri="https://github.com/openedx/credentials">Credentials</reference> IDA and then use them to render HTML
                certificates for <literal>Draft (Old) Mongo</literal> courses that have deprecated IDs.</paragraph>
            <paragraph>In order to transfer the signatures for <literal>Draft (Old) Mongo</literal> and <literal>Split Mongo</literal> courses,
                it is necessary to complete the next tasks.</paragraph>
            <bullet_list bullet="*">
                <list_item>
                    <paragraph>Extend credentials API to provide an option for adding and retrieving signatures.</paragraph>
                    <bullet_list bullet="*">
                        <list_item>
                            <paragraph><literal>CourseCertificateViewSet</literal> API should provide a possibility to optionally update
                                or create signatures for the course certificate.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph><literal>CourseCertificateViewSet</literal> API should provide a list of signatures configured for a course certificate.</paragraph>
                        </list_item>
                    </bullet_list>
                </list_item>
                <list_item>
                    <paragraph>Add a new <literal>OpenEdxPublicSignal</literal> that is emitted from Studio whenever certificate-related data is changed
                        (e.g., certificate image upload, course import). The signature image can be exposed as a URL.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Create a signal receiver function, that will copy the certificate configuration including signatures images
                        to <literal>CourseCertificate</literal> model in Credentials using <literal>CourseCertificateViewSet</literal> API.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Add a new management command to copy course certificates configurations,
                        including signatures configuration and assets, from MongoDB to Credentials.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Update render certificate views to get signatures from Credentials
                        <literal>CourseCertificateViewSet</literal> for <literal>Draft (Old) Mongo</literal> courses only.</paragraph>
                </list_item>
            </bullet_list>
            <section ids="example-of-the-certificate-configuration-stored-in-mongodb" names="example\ of\ the\ certificate\ configuration\ stored\ in\ mongodb:">
                <title>Example of the certificate configuration stored in MongoDB:</title>
                <literal_block force="False" highlight_args="{}" language="json" linenos="False" xml:space="preserve">{
  "certificates": {
    "certificates": [
      {
        "id": 853888039,
        "name": "Name of the certificate",
        "description": "Description of the certificate",
        "is_active": true,
        "version": 1,
        "signatories": [
          {
            "name": "Name",
            "title": "Title",
            "organization": "Organization",
            "signature_image_path": "/c4x/ooniversity/DJ101/asset/png-transparent-circle-white-circle-white-monochrome-black-thumbnail.png",
            "certificate": 853888039,
            "id": 1300534915
          }
        ],
        "course_title": "cert"
      }
    ]
  }
}</literal_block>
            </section>
            <section ids="credentials-coursecertificate-model" names="credentials\ coursecertificate\ model:">
                <title>Credentials CourseCertificate model:</title>
                <bullet_list bullet="*">
                    <list_item>
                        <paragraph>site</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>is_active</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>signatories</paragraph>
                        <bullet_list bullet="*">
                            <list_item>
                                <paragraph>Signatory fields:</paragraph>
                                <bullet_list bullet="*">
                                    <list_item>
                                        <paragraph>name</paragraph>
                                    </list_item>
                                    <list_item>
                                        <paragraph>title</paragraph>
                                    </list_item>
                                    <list_item>
                                        <paragraph>organization_name_override</paragraph>
                                    </list_item>
                                    <list_item>
                                        <paragraph>image</paragraph>
                                    </list_item>
                                </bullet_list>
                            </list_item>
                        </bullet_list>
                    </list_item>
                    <list_item>
                        <paragraph>title</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>course_id</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>course_run</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>certificate_available_date</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>certificate_type</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>user_credentials</paragraph>
                    </list_item>
                </bullet_list>
                <target ids="credentials" names="credentials" refuri="https://github.com/openedx/credentials"></target>
            </section>
        </section>
        <section ids="consequences" names="consequences">
            <title>Consequences</title>
            <bullet_list bullet="*">
                <list_item>
                    <paragraph>After implementing the new <literal>OpenEdxPublicSignal</literal> signal receiver,
                        every time the course or course certificate is updated,
                        certificate configuration including signatures configuration for
                        that course will be saved in <literal>CourseCertificate</literal> model in Credentials.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>During the certificate rendering, the certificate configuration fetched from MongoDB
                        will be merged with signatures configuration retrieved from Credentials.</paragraph>
                </list_item>
                <list_item>
                    <paragraph>After transferring course certificates configurations from MongoDB to Credentials,
                        it would be easier to migrate certificates management from edx-platform to Credentials IDA.</paragraph>
                </list_item>
            </bullet_list>
        </section>
        <section ids="alternatives-considered" names="alternatives\ considered">
            <title>Alternatives Considered</title>
            <bullet_list bullet="*">
                <list_item>
                    <paragraph><reference name="BD-11 Credentials Infrastructure + syncing" refuri="https://github.com/openedx/credentials/issues/1734">BD-11 Credentials Infrastructure + syncing</reference> – suggests migrating course certificates
                        configuration to credentials and migrate course certificates frontend to MFEs.</paragraph>
                </list_item>
            </bullet_list>
            <target ids="bd-11-credentials-infrastructure-syncing" names="bd-11\ credentials\ infrastructure\ +\ syncing" refuri="https://github.com/openedx/credentials/issues/1734"></target>
        </section>
        <section ids="references" names="references">
            <title>References</title>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph><reference name="Migrate signature assets from MongoDB GridFS to the Credentials IDA" refuri="https://github.com/openedx/credentials/issues/1765">Migrate signature assets from MongoDB GridFS to the Credentials IDA</reference><target ids="migrate-signature-assets-from-mongodb-gridfs-to-the-credentials-ida" names="migrate\ signature\ assets\ from\ mongodb\ gridfs\ to\ the\ credentials\ ida" refuri="https://github.com/openedx/credentials/issues/1765"></target></paragraph>
                </list_item>
                <list_item>
                    <paragraph><reference name="[DEPR]: DraftModuleStore (Old Mongo Modulestore)" refuri="https://github.com/openedx/public-engineering/issues/62">[DEPR]: DraftModuleStore (Old Mongo Modulestore)</reference><target ids="depr-draftmodulestore-old-mongo-modulestore" names="[depr]:\ draftmodulestore\ (old\ mongo\ modulestore)" refuri="https://github.com/openedx/public-engineering/issues/62"></target></paragraph>
                </list_item>
                <list_item>
                    <paragraph><reference name="Remove the ability to read and write static assets to Old Mongo" refuri="https://github.com/openedx/public-engineering/issues/77">Remove the ability to read and write static assets to Old Mongo</reference><target ids="remove-the-ability-to-read-and-write-static-assets-to-old-mongo" names="remove\ the\ ability\ to\ read\ and\ write\ static\ assets\ to\ old\ mongo" refuri="https://github.com/openedx/public-engineering/issues/77"></target></paragraph>
                </list_item>
            </bullet_list>
        </section>
    </section>
</document>
