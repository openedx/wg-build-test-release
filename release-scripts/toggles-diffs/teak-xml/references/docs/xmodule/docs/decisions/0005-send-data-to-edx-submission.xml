<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.21.2 -->
<document source="/Users/sarinacanelake/openedx/edx-platform/docs/references/docs/xmodule/docs/decisions/0005-send-data-to-edx-submission.rst" translation_progress="{'total': 0, 'translated': 0}" xmlns:c="https://www.sphinx-doc.org/" xmlns:changeset="https://www.sphinx-doc.org/" xmlns:citation="https://www.sphinx-doc.org/" xmlns:cpp="https://www.sphinx-doc.org/" xmlns:http="https://www.sphinx-doc.org/" xmlns:index="https://www.sphinx-doc.org/" xmlns:js="https://www.sphinx-doc.org/" xmlns:math="https://www.sphinx-doc.org/" xmlns:py="https://www.sphinx-doc.org/" xmlns:rst="https://www.sphinx-doc.org/" xmlns:std="https://www.sphinx-doc.org/">
    <section ids="implementation-to-send-student-response-to-edx-submission" names="implementation\ to\ send\ student\ response\ to\ edx-submission">
        <title>Implementation to send student response to edx-submission</title>
        <section ids="status" names="status">
            <title>Status</title>
            <paragraph>Accepted.</paragraph>
            <paragraph>2025-03-13</paragraph>
        </section>
        <section ids="context" names="context">
            <title>Context</title>
            <paragraph>Traditionally, the Open edX platform has utilized the <literal>XQueue</literal> service to handle student assignment submissions. However, to leverage a more modern and efficient architecture, there is a need to transition these submissions to the <literal>edx-submission</literal> service. This transition aims to improve the scalability and maintainability of the submission handling process.</paragraph>
        </section>
        <section ids="decision" names="decision">
            <title>Decision</title>
            <paragraph>The following changes have been implemented to redirect student submissions to the <title_reference>edx-submission</title_reference> service:</paragraph>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph><strong>Introduction of `send_to_submission` Function in `xqueue_submission.py`:</strong></paragraph>
                    <bullet_list bullet="-">
                        <list_item>
                            <paragraph><strong>Functionality:</strong> A new function, <title_reference>send_to_submission</title_reference>, has been developed to process student responses. It parses essential information such as <title_reference>course_id</title_reference>, <title_reference>item_id</title_reference>, <title_reference>student_id</title_reference>, and <title_reference>max_score</title_reference> from the submission data.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph><strong>Integration with `edx-submission`:</strong> The function utilizes the API provided by <title_reference>edx-submission</title_reference> to create a new submission record in the submissions database, ensuring that student responses are stored and processed accurately with the appropriate <title_reference>max_score</title_reference>.</paragraph>
                        </list_item>
                    </bullet_list>
                </list_item>
                <list_item>
                    <paragraph><strong>Modification of `xqueue_interfaces.py`:</strong></paragraph>
                    <bullet_list bullet="-">
                        <list_item>
                            <paragraph><strong>Service Selection Logic:</strong> The file <title_reference>xmodule/capa/xqueue_interfaces.py</title_reference> has been updated to include a condition that checks the state of the <title_reference>send_to_submission_course.enable</title_reference> <emphasis>waffle flag</emphasis>. If the flag is active for a specific course, student responses are directed to the <title_reference>edx-submission</title_reference> service via the <title_reference>send_to_submission</title_reference> function. If inactive, the submissions continue to be processed by <title_reference>XQueue</title_reference>.</paragraph>
                        </list_item>
                    </bullet_list>
                </list_item>
                <list_item>
                    <paragraph><strong>Temporary Waffle Flag Implementation:</strong></paragraph>
                    <bullet_list bullet="-">
                        <list_item>
                            <paragraph><strong>Definition:</strong> A course-level waffle flag named <title_reference>send_to_submission_course.enable</title_reference> has been introduced. Administrators can set this flag via the Django admin interface, enabling or disabling the <title_reference>edx-submission</title_reference> functionality for specific courses without requiring code changes.</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph><strong>Deprecation Plan:</strong> This <emphasis>waffle flag</emphasis> is a temporary measure to facilitate a smooth transition. Once the <title_reference>edx-submission</title_reference> service is fully adopted and validated, the flag will be deprecated, and all submissions will be processed exclusively through <title_reference>edx-submission</title_reference>.</paragraph>
                        </list_item>
                    </bullet_list>
                </list_item>
            </enumerated_list>
        </section>
        <section ids="configuration-for-xqueue-watcher" names="configuration\ for\ xqueue-watcher:">
            <title>Configuration for Xqueue-watcher:</title>
            <section ids="prerequisites" names="prerequisites">
                <title>Prerequisites</title>
                <bullet_list bullet="-">
                    <list_item>
                        <paragraph>Ensure you have the Xqueue repository cloned and running.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>Basic understanding of microservices and Docker (if applicable).</paragraph>
                    </list_item>
                </bullet_list>
            </section>
            <section ids="setting-up-xqueue-server" names="1.\ setting\ up\ xqueue-server">
                <title>1. Setting up Xqueue-Server</title>
                <paragraph><strong>Requirements:</strong></paragraph>
                <paragraph>First, clone the Xqueue repository into your environment:</paragraph>
                <literal_block force="False" highlight_args="{}" language="bash" linenos="False" xml:space="preserve">git clone https://github.com/openedx/xqueue.git</literal_block>
                <paragraph><strong>Steps:</strong></paragraph>
                <enumerated_list enumtype="arabic" prefix="" suffix=".">
                    <list_item>
                        <paragraph>Run the service using either Docker or as a microservice within your environment.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>Make sure to expose port <strong>18040</strong> since the service listens on this port:</paragraph>
                        <literal_block force="False" language="default" linenos="False" xml:space="preserve">http://127.0.0.1:18040</literal_block>
                    </list_item>
                    <list_item>
                        <paragraph>Verify that the service is running by accessing the configured URL or checking the service logs.</paragraph>
                    </list_item>
                </enumerated_list>
            </section>
            <section ids="configuring-xqueue-watcher" names="2.\ configuring\ xqueue-watcher">
                <title>2. Configuring Xqueue-Watcher</title>
                <paragraph><strong>Installation:</strong></paragraph>
                <enumerated_list enumtype="arabic" prefix="" suffix=".">
                    <list_item>
                        <paragraph>Clone the Xqueue-Watcher repository:</paragraph>
                    </list_item>
                </enumerated_list>
                <literal_block force="False" highlight_args="{}" language="bash" linenos="False" xml:space="preserve">git clone https://github.com/openedx/xqueue-watcher.git</literal_block>
                <enumerated_list enumtype="arabic" prefix="" start="2" suffix=".">
                    <list_item>
                        <paragraph>Navigate to the project directory and install any necessary dependencies:</paragraph>
                    </list_item>
                </enumerated_list>
                <literal_block force="False" highlight_args="{}" language="bash" linenos="False" xml:space="preserve">cd xqueue-watcher
pip install -r requirements.txt</literal_block>
                <paragraph><strong>Configuration:</strong></paragraph>
                <enumerated_list enumtype="arabic" prefix="" suffix=".">
                    <list_item>
                        <paragraph>Locate the configuration file at:</paragraph>
                        <literal_block force="False" language="default" linenos="False" xml:space="preserve">config/conf.d/course.json</literal_block>
                    </list_item>
                    <list_item>
                        <paragraph>Update the <title_reference>course.json</title_reference> file with the following configuration:</paragraph>
                    </list_item>
                </enumerated_list>
                <literal_block force="False" highlight_args="{}" language="json" linenos="False" xml:space="preserve">{
  "test-123": {
    "SERVER": "http://127.0.0.1:18040",
    "CONNECTIONS": 1,
    "AUTH": ["username", "password"]
  }
}</literal_block>
                <bullet_list bullet="-">
                    <list_item>
                        <paragraph><strong>test-123</strong>: The name of the queue to listen to.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph><strong>SERVER</strong>: The Xqueue server address.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph><strong>AUTH</strong>: A list containing <title_reference>[username, password]</title_reference> for Xqueue Django user authentication.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph><strong>CONNECTIONS</strong>: Number of threads to spawn to watch the queue.</paragraph>
                    </list_item>
                </bullet_list>
                <enumerated_list enumtype="arabic" prefix="" start="3" suffix=".">
                    <list_item>
                        <paragraph>Start the Xqueue-Watcher service:</paragraph>
                    </list_item>
                </enumerated_list>
                <literal_block force="False" highlight_args="{}" language="bash" linenos="False" xml:space="preserve">python watcher.py</literal_block>
            </section>
            <section ids="setting-up-xqueue-submission" names="3.\ setting\ up\ xqueue-submission">
                <title>3. Setting up Xqueue-Submission</title>
                <paragraph>This new flow sends queue data to <strong>edx-submission</strong> for processing.</paragraph>
                <paragraph><strong>Steps:</strong></paragraph>
                <enumerated_list enumtype="arabic" prefix="" suffix=".">
                    <list_item>
                        <paragraph>Create a new instance of Xqueue-Watcher:</paragraph>
                    </list_item>
                </enumerated_list>
                <literal_block force="False" highlight_args="{}" language="bash" linenos="False" xml:space="preserve">git clone https://github.com/openedx/xqueue-watcher.git</literal_block>
                <enumerated_list enumtype="arabic" prefix="" start="2" suffix=".">
                    <list_item>
                        <paragraph>Configure the new instance to listen on port <strong>8000</strong>. Edit the <title_reference>course.json</title_reference> file located at:</paragraph>
                        <literal_block force="False" language="default" linenos="False" xml:space="preserve">config/conf.d/course.json</literal_block>
                    </list_item>
                    <list_item>
                        <paragraph>Add the following configuration:</paragraph>
                    </list_item>
                </enumerated_list>
                <literal_block force="False" highlight_args="{}" language="json" linenos="False" xml:space="preserve">{
  "test-123": {
    "SERVER": "http://127.0.0.1:8000",
    "CONNECTIONS": 1,
    "AUTH": ["username", "password"]
  }
}</literal_block>
                <bullet_list bullet="-">
                    <list_item>
                        <paragraph><strong>SERVER</strong>: Now points to port <strong>8000</strong>, where edx-submission is running.</paragraph>
                    </list_item>
                </bullet_list>
                <enumerated_list enumtype="arabic" prefix="" start="4" suffix=".">
                    <list_item>
                        <paragraph>Start the new instance of Xqueue-Watcher:</paragraph>
                    </list_item>
                </enumerated_list>
                <literal_block force="False" highlight_args="{}" language="bash" linenos="False" xml:space="preserve">python watcher.py</literal_block>
            </section>
            <section ids="verification" names="4.\ verification">
                <title>4. Verification</title>
                <enumerated_list enumtype="arabic" prefix="" suffix=".">
                    <list_item>
                        <paragraph>Ensure that all services are running:
                            - Verify that ports <strong>18040</strong> and <strong>8000</strong> are active.
                            - Check the logs for connection errors or authentication issues.</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>Test the configuration:
                            - Send a test request to the queue <title_reference>test-123</title_reference> to confirm data processing through <strong>edx-submission</strong>.</paragraph>
                    </list_item>
                </enumerated_list>
            </section>
        </section>
        <section ids="consequences" names="consequences">
            <title>Consequences</title>
            <paragraph><strong>Positives:</strong></paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph><strong>Enhanced Submission Handling:</strong> Transitioning to the <title_reference>edx-submission</title_reference> service offers a more modern and efficient architecture for processing student responses, improving scalability and maintainability.</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>Controlled Migration:</strong> The temporary <emphasis>waffle flag</emphasis> allows for a phased transition, enabling administrators to test and adopt the new submission process on a per-course basis, thereby minimizing potential disruptions.</paragraph>
                </list_item>
            </bullet_list>
            <paragraph><strong>Negatives:</strong></paragraph>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph><strong>Increased Complexity:</strong> Introducing a temporary flag-based flow adds complexity to the codebase, which may increase maintenance efforts during the transition period.</paragraph>
                </list_item>
            </bullet_list>
        </section>
        <section ids="references" names="references">
            <title>References</title>
            <bullet_list bullet="-">
                <list_item>
                    <paragraph><strong>Feature Toggles documentation in Open edX</strong>: [Feature Toggles — edx-platform documentation](<reference refuri="https://docs.openedx.org/projects/edx-platform/en/latest/references/featuretoggles.html">https://docs.openedx.org/projects/edx-platform/en/latest/references/featuretoggles.html</reference>)</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>edx-submissions repository</strong>: [openedx/edx-submissions](<reference refuri="https://github.com/openedx/edx-submissions">https://github.com/openedx/edx-submissions</reference>)</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>edx-platform repository</strong>: [openedx/edx-platform](<reference refuri="https://github.com/openedx/edx-platform">https://github.com/openedx/edx-platform</reference>)</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>xqueue repository</strong>: [openedx/xqueue](<reference refuri="https://github.com/openedx/xqueue">https://github.com/openedx/xqueue</reference>)</paragraph>
                </list_item>
                <list_item>
                    <paragraph><strong>xqueue-watcher repository</strong>: [openedx/xqueue-watcher](<reference refuri="https://github.com/openedx/xqueue-watcher">https://github.com/openedx/xqueue-watcher</reference>)</paragraph>
                </list_item>
            </bullet_list>
        </section>
    </section>
</document>
